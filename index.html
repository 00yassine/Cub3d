<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎨 CUB3D Raycasting Visual Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23, #1a1a2e, #16213e, #0f3460);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: #fff;
            line-height: 1.6;
            overflow-x: auto;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* Floating particles background */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #00ff88;
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
            opacity: 0.7;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        h1 {
            text-align: center;
            margin-bottom: 40px;
            color: #00ff88;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            font-size: 3em;
            font-weight: bold;
            position: relative;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 20px rgba(0, 255, 136, 0.5); }
            to { text-shadow: 0 0 30px rgba(0, 255, 136, 0.8), 0 0 40px rgba(0, 255, 136, 0.3); }
        }

        h2 {
            color: #ffdd44;
            margin: 40px 0 20px 0;
            padding: 15px 20px;
            background: linear-gradient(135deg, rgba(255, 221, 68, 0.2), rgba(255, 221, 68, 0.1));
            border-radius: 12px;
            border-left: 5px solid #ffdd44;
            border: 2px solid rgba(255, 221, 68, 0.3);
            box-shadow: 0 4px 15px rgba(255, 221, 68, 0.2);
            font-size: 1.4em;
            position: relative;
            overflow: hidden;
        }

        h2::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        h2:hover::before {
            left: 100%;
        }

        h3 {
            color: #88ddff;
            margin: 25px 0 15px 0;
            font-size: 1.3em;
            padding: 8px 0;
            border-bottom: 2px solid rgba(136, 221, 255, 0.3);
        }

        .flowchart {
            background: linear-gradient(145deg, rgba(0,0,0,0.6), rgba(30, 60, 114, 0.3));
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .flowchart::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #00ff88, #88ddff, #ffdd44, #ff6b6b);
            background-size: 300% 100%;
            animation: borderGlow 3s ease infinite;
        }

        @keyframes borderGlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .flowchart:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.2);
        }

        .ascii-art {
            background: linear-gradient(145deg, #0a0a0a, #1a1a1a);
            color: #00ff88;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            white-space: pre;
            line-height: 1.3;
            border: 2px solid #333;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.5), 0 4px 15px rgba(0, 255, 136, 0.1);
            position: relative;
            transition: all 0.3s ease;
        }

        .ascii-art::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 8px;
            pointer-events: none;
        }

        .ascii-art:hover {
            color: #00ffaa;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.5), 0 4px 20px rgba(0, 255, 136, 0.3);
        }

        .code-block {
            background: linear-gradient(145deg, #2d2d2d, #1a1a1a);
            color: #f8f8f2;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.95em;
            overflow-x: auto;
            white-space: pre;
            border-left: 4px solid #ff6b6b;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
            position: relative;
            transition: all 0.3s ease;
        }

        .code-block::before {
            content: '{ }';
            position: absolute;
            top: 10px;
            right: 15px;
            color: #ff6b6b;
            font-weight: bold;
            opacity: 0.5;
        }

        .code-block:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.2);
            border-left-width: 6px;
        }

        .nav-menu {
            background: linear-gradient(145deg, rgba(0,0,0,0.8), rgba(30, 60, 114, 0.4));
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 40px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }

        .nav-menu a {
            color: #88ddff;
            text-decoration: none;
            margin: 8px 12px;
            padding: 12px 20px;
            border-radius: 25px;
            background: linear-gradient(145deg, rgba(136, 221, 255, 0.1), rgba(136, 221, 255, 0.05));
            border: 2px solid rgba(136, 221, 255, 0.2);
            transition: all 0.3s ease;
            display: inline-block;
            position: relative;
            overflow: hidden;
            font-weight: 500;
        }

        .nav-menu a::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .nav-menu a:hover {
            background: linear-gradient(145deg, rgba(136, 221, 255, 0.3), rgba(136, 221, 255, 0.1));
            color: #fff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(136, 221, 255, 0.3);
            border-color: rgba(136, 221, 255, 0.5);
        }

        .nav-menu a:hover::before {
            left: 100%;
        }

        /* Disabled nav state when advanced is hidden */
        .nav-menu a.disabled {
            opacity: 0.45;
            cursor: not-allowed;
            pointer-events: none;
            filter: grayscale(20%);
        }

        /* Clarity toolbar */
        .clarity-toolbar {
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin: 16px 0 24px;
        }

        .toggle-btn {
            color: #0b0b0b;
            background: #00ff88;
            border: none;
            padding: 10px 14px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s ease;
        }

        .toggle-btn.secondary {
            background: #88ddff;
        }

        .toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 18px rgba(0,0,0,0.35);
        }

        /* Legend */
        .legend {
            display: flex;
            gap: 18px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 10px 0 22px;
            background: linear-gradient(145deg, rgba(0,0,0,0.6), rgba(30, 60, 114, 0.25));
            border: 1px solid rgba(255,255,255,0.12);
            padding: 12px 14px;
            border-radius: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #d8eaff;
            font-size: 0.95em;
        }

        .legend-swatch {
            width: 14px;
            height: 14px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.4);
        }

        .legend .input { background: linear-gradient(135deg, #88ddff, #4488cc); }
        .legend .process { background: linear-gradient(135deg, #ffdd44, #cc9922); }
        .legend .render { background: linear-gradient(135deg, #ff6b6b, #cc4444); }
        .legend .ok { background: linear-gradient(135deg, #00ff88, #00cc66); }

        /* TL;DR summary blocks */
        .summary {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.12);
            border-left: 4px solid #00ff88;
            padding: 14px 16px;
            border-radius: 10px;
            margin: 12px 0 8px;
            color: #e6fff5;
        }

        .summary ul { margin-left: 18px; }
        .summary li { margin: 4px 0; }

        /* Simple (clarity) mode: flatter, calmer visuals */
        body.simple { background: #0f1020; animation: none !important; }
        body.simple h1 { animation: none; }
        body.simple .particles { display: none; }
        body.simple .flowchart { box-shadow: none; background: rgba(0,0,0,0.35); }
        body.simple .flowchart::before { display: none; }
        body.simple .nav-menu { box-shadow: none; }
        body.simple .nav-menu a { box-shadow: none; }
        body.simple svg rect:hover, body.simple svg text, body.simple svg circle:hover { transition: none; }
        body.simple .progress-bar { height: 6px; }

    /* Advanced sections toggle */
    body.hide-advanced .advanced-section { display: none; }
    /* Scroll indicator stays visible; we toggle dots via JS */

    .advanced-toggle { margin-top: 4px; }

        .highlight {
            background: rgba(255,221,68,0.2);
            padding: 2px 4px;
            border-radius: 3px;
            color: #ffdd44;
            font-weight: bold;
        }

        .tip {
            background: linear-gradient(135deg, rgba(0,255,136,0.15), rgba(0,255,136,0.05));
            border-left: 4px solid #00ff88;
            border-radius: 0 12px 12px 0;
            padding: 18px;
            margin: 20px 0;
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.1);
            transition: all 0.3s ease;
        }

        .tip::before {
            content: '💡';
            position: absolute;
            top: 15px;
            left: -15px;
            background: #00ff88;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .tip:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.2);
        }

        .warning {
            background: linear-gradient(135deg, rgba(255,107,107,0.15), rgba(255,107,107,0.05));
            border-left: 4px solid #ff6b6b;
            border-radius: 0 12px 12px 0;
            padding: 18px;
            margin: 20px 0;
            position: relative;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.1);
            transition: all 0.3s ease;
        }

        .warning::before {
            content: '⚠️';
            position: absolute;
            top: 15px;
            left: -15px;
            background: #ff6b6b;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .warning:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.2);
        }

        .info {
            background: linear-gradient(135deg, rgba(136,221,255,0.15), rgba(136,221,255,0.05));
            border-left: 4px solid #88ddff;
            border-radius: 0 12px 12px 0;
            padding: 18px;
            margin: 20px 0;
            position: relative;
            box-shadow: 0 4px 15px rgba(136, 221, 255, 0.1);
            transition: all 0.3s ease;
        }

        .info::before {
            content: 'ℹ️';
            position: absolute;
            top: 15px;
            left: -15px;
            background: #88ddff;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .info:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 20px rgba(136, 221, 255, 0.2);
        }

        .formula {
            background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            font-family: 'Times New Roman', serif;
            font-size: 1.2em;
            margin: 20px 0;
            border: 2px dashed rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
            position: relative;
            transition: all 0.3s ease;
            font-weight: bold;
            color: #ffdd44;
        }

        .formula::before {
            content: '∑';
            position: absolute;
            top: -10px;
            left: 20px;
            background: #ffdd44;
            color: #000;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
        }

        .formula:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 20px rgba(255, 221, 68, 0.3);
            border-color: rgba(255, 221, 68, 0.5);
        }

        /* Progress bar for sections */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background: linear-gradient(90deg, #00ff88, #88ddff, #ffdd44, #ff6b6b);
            z-index: 9999;
            transition: width 0.3s ease;
        }

        /* Scroll indicator */
        .scroll-indicator {
            position: fixed;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
        }

        .scroll-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scroll-dot.active {
            background: #00ff88;
            transform: scale(1.3);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        /* Enhanced SVG animations */
        .svg-element {
            animation: svgLoad 1s ease-in-out;
        }

        @keyframes svgLoad {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Interactive SVG hover effects */
        svg text {
            transition: all 0.3s ease;
        }

        svg rect:hover {
            filter: brightness(1.2);
            transform: scale(1.02);
            transition: all 0.3s ease;
        }

        svg circle:hover {
            r: 8;
            transition: all 0.3s ease;
        }

        /* Mathematical formula enhancements */
        .formula-container {
            background: linear-gradient(135deg, rgba(255,221,68,0.2), rgba(255,221,68,0.1));
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 2px solid rgba(255,221,68,0.3);
            position: relative;
            overflow: hidden;
        }

        .formula-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.6s;
        }

        .formula-container:hover::before {
            left: 100%;
        }

        .math-step {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #00ff88;
            font-family: 'Courier New', monospace;
            position: relative;
        }

        .math-step::before {
            content: counter(step-counter);
            counter-increment: step-counter;
            position: absolute;
            left: -20px;
            top: 15px;
            background: #00ff88;
            color: #000;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }

        .math-example {
            counter-reset: step-counter;
        }

        /* Enhanced tooltip system */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            color: #88ddff;
            text-decoration: underline dotted;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #fff;
            text-align: center;
            border-radius: 12px;
            padding: 15px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: all 0.3s ease;
            border: 2px solid rgba(136, 221, 255, 0.3);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -8px;
            border-width: 8px;
            border-style: solid;
            border-color: #1a1a2e transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(-5px);
        }

        /* Code syntax highlighting */
        .code-highlight {
            color: #ff6b6b;
            font-weight: bold;
        }

        .code-comment {
            color: #6c7086;
            font-style: italic;
        }

        .code-function {
            color: #89b4fa;
        }

        .code-variable {
            color: #cdd6f4;
        }

        .code-number {
            color: #fab387;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            h1 {
                font-size: 2em;
            }

            .ascii-art {
                font-size: 0.7em;
            }

            .nav-menu a {
                display: block;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>

    <!-- Progress Bar -->
    <div class="progress-bar" id="progressBar"></div>

    <!-- Global SVG Definitions -->
    <svg width="0" height="0" style="position:absolute;" aria-hidden="true" focusable="false">
        <defs>
            <filter id="globalGlow">
                <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                <feMerge>
                    <feMergeNode in="coloredBlur"/>
                    <feMergeNode in="SourceGraphic"/>
                </feMerge>
            </filter>
        </defs>
    </svg>

    <!-- Scroll Indicator -->
    <div class="scroll-indicator" id="scrollIndicator">
        <div class="scroll-dot" data-target="simple"></div>
        <div class="scroll-dot" data-target="overview"></div>
        <div class="scroll-dot" data-target="dda"></div>
        <div class="scroll-dot" data-target="texture"></div>
        <div class="scroll-dot" data-target="problems"></div>
        <div class="scroll-dot" data-target="reference"></div>
        <div class="scroll-dot" data-target="mathematical"></div>
        <div class="scroll-dot" data-target="input-output"></div>
        <div class="scroll-dot" data-target="example"></div>
    </div>

    <div class="container">
        <h1>🎨 CUB3D Raycasting Visual Guide</h1>

        <div class="nav-menu">
            <a href="#simple">🧭 Simple Flowchart</a>
            <a href="#overview" data-advanced="true">🔄 System Overview</a>
            <a href="#dda" data-advanced="true">📐 DDA Algorithm</a>
            <a href="#texture" data-advanced="true">🎨 Texture Mapping</a>
            <a href="#problems" data-advanced="true">🔧 Problem Solutions</a>
            <a href="#reference" data-advanced="true">📋 Quick Reference</a>
            <a href="#mathematical" data-advanced="true">📐 Math Formulas</a>
            <a href="#input-output" data-advanced="true">🎮 Input Flow</a>
            <a href="#example" data-advanced="true">🏆 Complete Example</a>
        </div>

        <div class="clarity-toolbar" aria-label="Clarity tools">
            <button id="toggleSimple" class="toggle-btn" type="button">🧼 Simple mode</button>
            <button id="toggleSummaries" class="toggle-btn secondary" type="button">📝 Show TL;DR</button>
            <button id="toggleAdvanced" class="toggle-btn advanced-toggle" type="button">🔎 Show advanced</button>
        </div>

        <div class="legend" role="note" aria-label="Diagram legend">
            <div class="legend-item"><span class="legend-swatch input"></span> Input / Setup</div>
            <div class="legend-item"><span class="legend-swatch process"></span> Process / Loop step</div>
            <div class="legend-item"><span class="legend-swatch render"></span> Raycast / Render</div>
            <div class="legend-item"><span class="legend-swatch ok"></span> Result / Output</div>
        </div>

        <div class="info">
            <strong>✨ Interactive Raycasting Guide</strong><br>
            This guide contains visual flowcharts and diagrams to help you understand the CUB3D raycasting engine.
            All diagrams are optimized for both desktop and mobile viewing.
        </div>

        <!-- Simple all-in-one flowchart (start here) -->
        <section id="simple">
            <h2>🧭 Simple Flowchart (Start Here)</h2>
            <div class="summary">
                <ul>
                    <li>Init → Input → Move/Rotate → Cast rays → Texture → Draw → Display → Repeat.</li>
                    <li>DDA finds nearest wall per ray; fisheye correction keeps walls straight.</li>
                    <li>Texture X from hit offset; wall height ∝ 1/distance.</li>
                </ul>
            </div>
            <div class="flowchart">
                <svg viewBox="0 0 1000 520" style="width: 100%; height: auto; background: #0b0b0b; border-radius: 10px;" role="img" aria-labelledby="simpleTitle simpleDesc">
                    <defs>
                        <linearGradient id="sIn" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#88ddff"/>
                            <stop offset="100%" style="stop-color:#4488cc"/>
                        </linearGradient>
                        <linearGradient id="sProc" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffdd44"/>
                            <stop offset="100%" style="stop-color:#cc9922"/>
                        </linearGradient>
                        <linearGradient id="sCast" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff6b6b"/>
                            <stop offset="100%" style="stop-color:#cc4444"/>
                        </linearGradient>
                        <linearGradient id="sOut" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#00ff88"/>
                            <stop offset="100%" style="stop-color:#00cc66"/>
                        </linearGradient>
                        <marker id="sArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#ffffff"/>
                        </marker>
                    </defs>
                    <title id="simpleTitle">Simple Cub3D raycasting flow</title>
                    <desc id="simpleDesc">Basic steps from initialization through per-frame loop: handle input, update player, cast rays with DDA, map textures, draw, and display.</desc>

                    <!-- Row 1: Init → Hooks → Loop -->
                    <g transform="translate(60, 40)">
                        <rect x="0" y="0" width="220" height="60" rx="10" fill="url(#sIn)" stroke="#88ddff"/>
                        <text x="110" y="35" text-anchor="middle" fill="#fff" font-weight="bold">Init (MLX, Map, Textures)</text>

                        <line x1="220" y1="30" x2="260" y2="30" stroke="#fff" stroke-width="2" marker-end="url(#sArrow)"/>
                        <rect x="260" y="0" width="200" height="60" rx="10" fill="url(#sIn)" stroke="#88ddff"/>
                        <text x="360" y="35" text-anchor="middle" fill="#fff" font-weight="bold">Setup Hooks</text>

                        <line x1="460" y1="30" x2="500" y2="30" stroke="#fff" stroke-width="2" marker-end="url(#sArrow)"/>
                        <rect x="500" y="0" width="220" height="60" rx="10" fill="url(#sProc)" stroke="#ffdd44"/>
                        <text x="610" y="35" text-anchor="middle" fill="#000" font-weight="bold">Main Loop</text>
                    </g>

                    <!-- Row 2: Input → Move → Rotate → Clear -->
                    <g transform="translate(60, 140)">
                        <rect x="0" y="0" width="160" height="60" rx="10" fill="url(#sProc)" stroke="#ffdd44"/>
                        <text x="80" y="35" text-anchor="middle" fill="#000" font-weight="bold">Input</text>
                        <line x1="160" y1="30" x2="200" y2="30" stroke="#fff" stroke-width="2" marker-end="url(#sArrow)"/>

                        <rect x="200" y="0" width="160" height="60" rx="10" fill="url(#sProc)" stroke="#ffdd44"/>
                        <text x="280" y="35" text-anchor="middle" fill="#000" font-weight="bold">Move + Collide</text>
                        <line x1="360" y1="30" x2="400" y2="30" stroke="#fff" stroke-width="2" marker-end="url(#sArrow)"/>

                        <rect x="400" y="0" width="160" height="60" rx="10" fill="url(#sProc)" stroke="#ffdd44"/>
                        <text x="480" y="35" text-anchor="middle" fill="#000" font-weight="bold">Rotate</text>
                        <line x1="560" y1="30" x2="600" y2="30" stroke="#fff" stroke-width="2" marker-end="url(#sArrow)"/>

                        <rect x="600" y="0" width="160" height="60" rx="10" fill="url(#sProc)" stroke="#ffdd44"/>
                        <text x="680" y="35" text-anchor="middle" fill="#000" font-weight="bold">Clear Buffer</text>
                    </g>

                    <!-- Row 3: Raycast (DDA) → Texture → Draw → Display -->
                    <g transform="translate(60, 240)">
                        <rect x="0" y="0" width="200" height="70" rx="10" fill="url(#sCast)" stroke="#ff6b6b"/>
                        <text x="100" y="30" text-anchor="middle" fill="#fff" font-weight="bold">Raycast (DDA)</text>
                        <text x="100" y="50" text-anchor="middle" fill="#ffec99" font-size="12">min(h,v) distance</text>
                        <line x1="200" y1="35" x2="240" y2="35" stroke="#fff" stroke-width="2" marker-end="url(#sArrow)"/>

                        <rect x="240" y="0" width="200" height="70" rx="10" fill="url(#sCast)" stroke="#ff6b6b"/>
                        <text x="340" y="30" text-anchor="middle" fill="#fff" font-weight="bold">Texture X</text>
                        <text x="340" y="50" text-anchor="middle" fill="#ffec99" font-size="12">offset→tex_x</text>
                        <line x1="440" y1="35" x2="480" y2="35" stroke="#fff" stroke-width="2" marker-end="url(#sArrow)"/>

                        <rect x="480" y="0" width="160" height="70" rx="10" fill="url(#sOut)" stroke="#00ff88"/>
                        <text x="560" y="30" text-anchor="middle" fill="#000" font-weight="bold">Draw Column</text>
                        <text x="560" y="50" text-anchor="middle" fill="#003322" font-size="12">h = k/dist</text>
                        <line x1="640" y1="35" x2="680" y2="35" stroke="#fff" stroke-width="2" marker-end="url(#sArrow)"/>

                        <rect x="680" y="0" width="160" height="70" rx="10" fill="url(#sOut)" stroke="#00ff88"/>
                        <text x="760" y="30" text-anchor="middle" fill="#000" font-weight="bold">Display</text>
                        <text x="760" y="50" text-anchor="middle" fill="#003322" font-size="12">mlx_put_image</text>
                    </g>

                    <!-- Loop arrow back to Input -->
                    <path d="M 900 275 C 930 275 940 300 940 320 C 940 360 900 370 520 370 C 250 370 120 370 100 350 C 80 330 95 300 120 295" fill="none" stroke="#88ddff" stroke-width="2" marker-end="url(#sArrow)"/>
                    <text x="520" y="390" text-anchor="middle" fill="#88ddff" font-size="12">repeat next frame</text>
                </svg>
            </div>
        </section>

        <section id="overview" class="advanced-section">
            <h2>📊 Complete System Flowchart</h2>
            <div class="summary">
                <ul>
                    <li>Initialize graphics, load textures, parse map.</li>
                    <li>Each frame: read input → move/rotate → raycast → draw → display.</li>
                    <li>Repeat in the MLX main loop at ~60 FPS.</li>
                </ul>
            </div>
            <div class="flowchart">
                <svg viewBox="0 0 1000 800" style="width: 100%; height: auto; background: #0a0a0a; border-radius: 10px;" role="img" aria-labelledby="overviewTitle overviewDesc">
                    <!-- Definitions for gradients and shadows -->
                    <defs>
                        <linearGradient id="startGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#00cc66;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="processGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#88ddff;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#4488cc;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="loopGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffdd44;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#cc9922;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="raycastGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff6b6b;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#cc4444;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <title id="overviewTitle">Cub3D system overview</title>
                    <desc id="overviewDesc">From init to main loop: read input, update movement and rotation, cast rays, draw column, and display the frame. Repeats each frame.</desc>

                    <!-- START -->
                    <rect x="400" y="20" width="200" height="60" rx="30" fill="url(#startGrad)" filter="url(#globalGlow)" stroke="#00ff88" stroke-width="2"/>
                    <text x="500" y="55" text-anchor="middle" fill="white" font-size="16" font-weight="bold">🚀 START</text>

                    <!-- Arrow down -->
                    <line x1="500" y1="80" x2="500" y2="110" stroke="#00ff88" stroke-width="3" marker-end="url(#arrowhead)"/>

                    <!-- Initialize -->
                    <rect x="350" y="120" width="300" height="80" rx="10" fill="url(#processGrad)" filter="url(#globalGlow)" stroke="#88ddff" stroke-width="2"/>
                    <text x="500" y="145" text-anchor="middle" fill="white" font-size="14" font-weight="bold">Initialize MLX</text>
                    <text x="500" y="165" text-anchor="middle" fill="white" font-size="12">Load Textures • Setup Window</text>
                    <text x="500" y="185" text-anchor="middle" fill="white" font-size="12">Parse Map</text>

                    <!-- Arrow down -->
                    <line x1="500" y1="200" x2="500" y2="230" stroke="#88ddff" stroke-width="3" marker-end="url(#arrowhead)"/>

                    <!-- Setup Hooks -->
                    <rect x="350" y="240" width="300" height="80" rx="10" fill="url(#processGrad)" filter="url(#globalGlow)" stroke="#88ddff" stroke-width="2"/>
                    <text x="500" y="265" text-anchor="middle" fill="white" font-size="14" font-weight="bold">Setup Event Hooks</text>
                    <text x="500" y="285" text-anchor="middle" fill="white" font-size="12">Key Press • Mouse • Window Close</text>
                    <text x="500" y="305" text-anchor="middle" fill="white" font-size="12">Loop Hook</text>

                    <!-- Arrow down -->
                    <line x1="500" y1="320" x2="500" y2="350" stroke="#88ddff" stroke-width="3" marker-end="url(#arrowhead)"/>

                    <!-- Main Loop Container -->
                    <rect x="50" y="360" width="900" height="350" rx="15" fill="rgba(255,221,68,0.1)" stroke="#ffdd44" stroke-width="3" stroke-dasharray="10,5"/>
                    <text x="500" y="385" text-anchor="middle" fill="#ffdd44" font-size="18" font-weight="bold">🔄 MLX MAIN LOOP (60 FPS)</text>

                    <!-- Input Processing -->
                    <rect x="80" y="400" width="180" height="60" rx="8" fill="url(#loopGrad)" filter="url(#globalGlow)" stroke="#ffdd44" stroke-width="2"/>
                    <text x="170" y="425" text-anchor="middle" fill="white" font-size="12" font-weight="bold">1. INPUT</text>
                    <text x="170" y="445" text-anchor="middle" fill="white" font-size="10">W/S/A/D Keys</text>

                    <!-- Movement Update -->
                    <rect x="280" y="400" width="180" height="60" rx="8" fill="url(#loopGrad)" filter="url(#globalGlow)" stroke="#ffdd44" stroke-width="2"/>
                    <text x="370" y="425" text-anchor="middle" fill="white" font-size="12" font-weight="bold">2. MOVEMENT</text>
                    <text x="370" y="445" text-anchor="middle" fill="white" font-size="10">Position + Collision</text>

                    <!-- Rotation -->
                    <rect x="480" y="400" width="180" height="60" rx="8" fill="url(#loopGrad)" filter="url(#globalGlow)" stroke="#ffdd44" stroke-width="2"/>
                    <text x="570" y="425" text-anchor="middle" fill="white" font-size="12" font-weight="bold">3. ROTATION</text>
                    <text x="570" y="445" text-anchor="middle" fill="white" font-size="10">Angle Update</text>

                    <!-- Clear Buffer -->
                    <rect x="680" y="400" width="180" height="60" rx="8" fill="url(#loopGrad)" filter="url(#globalGlow)" stroke="#ffdd44" stroke-width="2"/>
                    <text x="770" y="425" text-anchor="middle" fill="white" font-size="12" font-weight="bold">4. CLEAR</text>
                    <text x="770" y="445" text-anchor="middle" fill="white" font-size="10">Frame Buffer</text>

                    <!-- Main Raycasting Box -->
                    <rect x="150" y="480" width="600" height="120" rx="10" fill="url(#raycastGrad)" filter="url(#globalGlow)" stroke="#ff6b6b" stroke-width="3"/>
                    <text x="450" y="505" text-anchor="middle" fill="white" font-size="16" font-weight="bold">🎯 5. RAYCASTING ENGINE</text>

                    <!-- Raycasting Steps -->
                    <rect x="170" y="520" width="100" height="35" rx="5" fill="#ff8888" stroke="#ffffff" stroke-width="1"/>
                    <text x="220" y="540" text-anchor="middle" fill="white" font-size="10">Ray Angle</text>

                    <rect x="290" y="520" width="100" height="35" rx="5" fill="#ff8888" stroke="#ffffff" stroke-width="1"/>
                    <text x="340" y="540" text-anchor="middle" fill="white" font-size="10">DDA Cast</text>

                    <rect x="410" y="520" width="100" height="35" rx="5" fill="#ff8888" stroke="#ffffff" stroke-width="1"/>
                    <text x="460" y="540" text-anchor="middle" fill="white" font-size="10">Fisheye Fix</text>

                    <rect x="530" y="520" width="100" height="35" rx="5" fill="#ff8888" stroke="#ffffff" stroke-width="1"/>
                    <text x="580" y="540" text-anchor="middle" fill="white" font-size="10">Texture</text>

                    <rect x="290" y="565" width="170" height="25" rx="5" fill="#ff9999" stroke="#ffffff" stroke-width="1"/>
                    <text x="375" y="580" text-anchor="middle" fill="white" font-size="10">Draw Column</text>

                    <!-- Minimap -->
                    <rect x="80" y="620" width="150" height="50" rx="8" fill="url(#processGrad)" filter="url(#globalGlow)" stroke="#88ddff" stroke-width="2"/>
                    <text x="155" y="645" text-anchor="middle" fill="white" font-size="12" font-weight="bold">6. MINIMAP</text>
                    <text x="155" y="660" text-anchor="middle" fill="white" font-size="10">(Optional)</text>

                    <!-- Display -->
                    <rect x="250" y="620" width="150" height="50" rx="8" fill="url(#processGrad)" filter="url(#globalGlow)" stroke="#88ddff" stroke-width="2"/>
                    <text x="325" y="645" text-anchor="middle" fill="white" font-size="12" font-weight="bold">7. DISPLAY</text>
                    <text x="325" y="660" text-anchor="middle" fill="white" font-size="10">mlx_put_image</text>

                    <!-- Repeat Arrow -->
                    <path d="M 450 680 Q 550 700 600 680 Q 650 660 700 680 Q 750 700 800 680 Q 850 660 900 680 Q 920 690 900 720 Q 850 750 50 750 Q 20 750 20 720 Q 20 400 50 400"
                          fill="none" stroke="#00ff88" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>

                    <!-- Repeat Label -->
                    <rect x="420" y="740" width="160" height="40" rx="20" fill="url(#startGrad)" filter="url(#globalGlow)" stroke="#00ff88" stroke-width="2"/>
                    <text x="500" y="765" text-anchor="middle" fill="white" font-size="14" font-weight="bold">🔄 REPEAT</text>

                    <!-- Arrow markers -->
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#00ff88"/>
                        </marker>
                    </defs>

                    <!-- Connection lines -->
                    <line x1="170" y1="460" x2="170" y2="480" stroke="#ffdd44" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <line x1="370" y1="460" x2="370" y2="480" stroke="#ffdd44" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <line x1="570" y1="460" x2="570" y2="480" stroke="#ffdd44" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <line x1="770" y1="460" x2="770" y2="480" stroke="#ffdd44" stroke-width="2" marker-end="url(#arrowhead)"/>

                    <line x1="220" y1="555" x2="290" y2="540" stroke="#ffffff" stroke-width="1"/>
                    <line x1="340" y1="555" x2="410" y2="540" stroke="#ffffff" stroke-width="1"/>
                    <line x1="460" y1="555" x2="530" y2="540" stroke="#ffffff" stroke-width="1"/>
                    <line x1="375" y1="555" x2="375" y2="565" stroke="#ffffff" stroke-width="2"/>

                    <line x1="450" y1="600" x2="155" y2="620" stroke="#ff6b6b" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <line x1="450" y1="600" x2="325" y2="620" stroke="#ff6b6b" stroke-width="2" marker-end="url(#arrowhead)"/>
                </svg>
            </div>
        </section>

    <section id="dda" class="advanced-section">
            <h2>🎯 DDA Algorithm Detailed Flow</h2>
            <div class="summary">
                <ul>
                    <li>Start from player position and current ray angle.</li>
                    <li>Cast horizontally and vertically, stepping grid lines until a wall is hit.</li>
                    <li>Pick the closest hit (min distance) → that’s the wall slice to render.</li>
                </ul>
            </div>
            <div class="flowchart">
                <svg viewBox="0 0 1000 700" style="width: 100%; height: auto; background: #0a0a0a; border-radius: 10px;" role="img" aria-labelledby="ddaTitle ddaDesc">
                    <defs>
                        <linearGradient id="inputGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#88ddff;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#4488cc;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="horizontalGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffdd44;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#cc9922;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="verticalGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff6b6b;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#cc4444;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="outputGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#00cc66;stop-opacity:1" />
                        </linearGradient>
                        <marker id="arrowhead2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#ffffff"/>
                        </marker>
                    </defs>

                    <!-- Title -->
                    <title id="ddaTitle">DDA raycasting decision flow</title>
                    <desc id="ddaDesc">Compute hits on horizontal and vertical grid lines and take the minimum distance to find the visible wall.</desc>
                    <text x="500" y="25" text-anchor="middle" fill="#88ddff" font-size="20" font-weight="bold">🎯 DDA Algorithm Flow</text>

                    <!-- Input -->
                    <rect x="350" y="50" width="300" height="60" rx="10" fill="url(#inputGrad)" filter="url(#globalGlow)" stroke="#88ddff" stroke-width="2"/>
                    <text x="500" y="75" text-anchor="middle" fill="white" font-size="14" font-weight="bold">📍 INPUT</text>
                    <text x="500" y="95" text-anchor="middle" fill="white" font-size="12">Player (px, py) • Ray Angle (θ)</text>

                    <!-- Split into Horizontal and Vertical -->
                    <line x1="500" y1="110" x2="500" y2="140" stroke="#88ddff" stroke-width="3" marker-end="url(#arrowhead2)"/>
                    <line x1="500" y1="140" x2="250" y2="170" stroke="#ffdd44" stroke-width="3" marker-end="url(#arrowhead2)"/>
                    <line x1="500" y1="140" x2="750" y2="170" stroke="#ff6b6b" stroke-width="3" marker-end="url(#arrowhead2)"/>

                    <!-- Horizontal Ray Casting -->
                    <rect x="50" y="180" width="400" height="200" rx="15" fill="rgba(255,221,68,0.1)" stroke="#ffdd44" stroke-width="3"/>
                    <text x="250" y="205" text-anchor="middle" fill="#ffdd44" font-size="16" font-weight="bold">↔️ HORIZONTAL RAY CASTING</text>

                    <!-- Horizontal Steps -->
                    <rect x="70" y="220" width="160" height="40" rx="8" fill="url(#horizontalGrad)" stroke="#ffffff" stroke-width="1"/>
                    <text x="150" y="235" text-anchor="middle" fill="white" font-size="11" font-weight="bold">1. Find Grid Line</text>
                    <text x="150" y="250" text-anchor="middle" fill="white" font-size="9">y = tile_y * TILE_SIZE</text>

                    <rect x="250" y="220" width="160" height="40" rx="8" fill="url(#horizontalGrad)" stroke="#ffffff" stroke-width="1"/>
                    <text x="330" y="235" text-anchor="middle" fill="white" font-size="11" font-weight="bold">2. Calculate Steps</text>
                    <text x="330" y="250" text-anchor="middle" fill="white" font-size="9">step_x = step_y / tan(θ)</text>

                    <rect x="70" y="280" width="160" height="40" rx="8" fill="url(#horizontalGrad)" stroke="#ffffff" stroke-width="1"/>
                    <text x="150" y="295" text-anchor="middle" fill="white" font-size="11" font-weight="bold">3. Step Through</text>
                    <text x="150" y="310" text-anchor="middle" fill="white" font-size="9">until wall hit</text>

                    <rect x="250" y="280" width="160" height="40" rx="8" fill="url(#horizontalGrad)" stroke="#ffffff" stroke-width="1"/>
                    <text x="330" y="295" text-anchor="middle" fill="white" font-size="11" font-weight="bold">4. Get Distance</text>
                    <text x="330" y="310" text-anchor="middle" fill="white" font-size="9">h_dist = √[(x-px)²+(y-py)²]</text>

                    <!-- Grid Visualization for Horizontal -->
                    <g transform="translate(80, 340)">
                        <!-- Grid lines -->
                        <line x1="0" y1="10" x2="120" y2="10" stroke="#666" stroke-width="1"/>
                        <line x1="0" y1="30" x2="120" y2="30" stroke="#666" stroke-width="1"/>
                        <line x1="20" y1="0" x2="20" y2="40" stroke="#666" stroke-width="1"/>
                        <line x1="40" y1="0" x2="40" y2="40" stroke="#666" stroke-width="1"/>
                        <line x1="60" y1="0" x2="60" y2="40" stroke="#666" stroke-width="1"/>
                        <line x1="80" y1="0" x2="80" y2="40" stroke="#666" stroke-width="1"/>
                        <line x1="100" y1="0" x2="100" y2="40" stroke="#666" stroke-width="1"/>
                        <!-- Player -->
                        <circle cx="15" cy="25" r="3" fill="#00ff88"/>
                        <text x="15" y="35" text-anchor="middle" fill="#00ff88" font-size="8">P</text>
                        <!-- Ray -->
                        <line x1="15" y1="25" x2="85" y2="15" stroke="#ffdd44" stroke-width="2"/>
                        <!-- Intersection points -->
                        <circle cx="35" cy="20" r="2" fill="#ffdd44"/>
                        <circle cx="55" cy="17" r="2" fill="#ffdd44"/>
                        <circle cx="75" cy="15" r="2" fill="#ffdd44"/>
                        <!-- Wall hit -->
                        <rect x="80" y="10" width="8" height="20" fill="#ff6b6b"/>
                    </g>

                    <!-- Vertical Ray Casting -->
                    <rect x="550" y="180" width="400" height="200" rx="15" fill="rgba(255,107,107,0.1)" stroke="#ff6b6b" stroke-width="3"/>
                    <text x="750" y="205" text-anchor="middle" fill="#ff6b6b" font-size="16" font-weight="bold">↕️ VERTICAL RAY CASTING</text>

                    <!-- Vertical Steps -->
                    <rect x="570" y="220" width="160" height="40" rx="8" fill="url(#verticalGrad)" stroke="#ffffff" stroke-width="1"/>
                    <text x="650" y="235" text-anchor="middle" fill="white" font-size="11" font-weight="bold">1. Find Grid Line</text>
                    <text x="650" y="250" text-anchor="middle" fill="white" font-size="9">x = tile_x * TILE_SIZE</text>

                    <rect x="750" y="220" width="160" height="40" rx="8" fill="url(#verticalGrad)" stroke="#ffffff" stroke-width="1"/>
                    <text x="830" y="235" text-anchor="middle" fill="white" font-size="11" font-weight="bold">2. Calculate Steps</text>
                    <text x="830" y="250" text-anchor="middle" fill="white" font-size="9">step_y = step_x * tan(θ)</text>

                    <rect x="570" y="280" width="160" height="40" rx="8" fill="url(#verticalGrad)" stroke="#ffffff" stroke-width="1"/>
                    <text x="650" y="295" text-anchor="middle" fill="white" font-size="11" font-weight="bold">3. Step Through</text>
                    <text x="650" y="310" text-anchor="middle" fill="white" font-size="9">until wall hit</text>

                    <rect x="750" y="280" width="160" height="40" rx="8" fill="url(#verticalGrad)" stroke="#ffffff" stroke-width="1"/>
                    <text x="830" y="295" text-anchor="middle" fill="white" font-size="11" font-weight="bold">4. Get Distance</text>
                    <text x="830" y="310" text-anchor="middle" fill="white" font-size="9">v_dist = √[(x-px)²+(y-py)²]</text>

                    <!-- Grid Visualization for Vertical -->
                    <g transform="translate(580, 340)">
                        <!-- Grid lines -->
                        <line x1="10" y1="0" x2="10" y2="40" stroke="#666" stroke-width="1"/>
                        <line x1="30" y1="0" x2="30" y2="40" stroke="#666" stroke-width="1"/>
                        <line x1="50" y1="0" x2="50" y2="40" stroke="#666" stroke-width="1"/>
                        <line x1="0" y1="10" x2="60" y2="10" stroke="#666" stroke-width="1"/>
                        <line x1="0" y1="30" x2="60" y2="30" stroke="#666" stroke-width="1"/>
                        <!-- Player -->
                        <circle cx="15" cy="25" r="3" fill="#00ff88"/>
                        <text x="15" y="35" text-anchor="middle" fill="#00ff88" font-size="8">P</text>
                        <!-- Ray -->
                        <line x1="15" y1="25" x2="45" y2="5" stroke="#ff6b6b" stroke-width="2"/>
                        <!-- Intersection points -->
                        <circle cx="25" cy="18" r="2" fill="#ff6b6b"/>
                        <circle cx="35" cy="11" r="2" fill="#ff6b6b"/>
                        <!-- Wall hit -->
                        <rect x="40" y="0" width="10" height="8" fill="#ff6b6b"/>
                    </g>

                    <!-- Decision Diamond -->
                    <polygon points="500,420 530,450 500,480 470,450" fill="rgba(255,255,255,0.2)" stroke="#ffffff" stroke-width="2"/>
                    <text x="500" y="455" text-anchor="middle" fill="white" font-size="12" font-weight="bold">min?</text>

                    <!-- Arrows to decision -->
                    <line x1="250" y1="380" x2="480" y2="440" stroke="#ffdd44" stroke-width="3" marker-end="url(#arrowhead2)"/>
                    <line x1="750" y1="380" x2="520" y2="440" stroke="#ff6b6b" stroke-width="3" marker-end="url(#arrowhead2)"/>

                    <!-- Output -->
                    <rect x="350" y="520" width="300" height="80" rx="10" fill="url(#outputGrad)" filter="url(#globalGlow)" stroke="#00ff88" stroke-width="2"/>
                    <text x="500" y="545" text-anchor="middle" fill="white" font-size="14" font-weight="bold">🎯 OUTPUT</text>
                    <text x="500" y="565" text-anchor="middle" fill="white" font-size="12">Hit Point (hx, hy)</text>
                    <text x="500" y="580" text-anchor="middle" fill="white" font-size="12">Distance • Wall Type</text>

                    <!-- Arrow to output -->
                    <line x1="500" y1="480" x2="500" y2="520" stroke="#00ff88" stroke-width="3" marker-end="url(#arrowhead2)"/>

                    <!-- Labels -->
                    <text x="250" y="440" text-anchor="middle" fill="#ffdd44" font-size="10">h_dist</text>
                    <text x="750" y="440" text-anchor="middle" fill="#ff6b6b" font-size="10">v_dist</text>

                    <!-- Result label -->
                    <rect x="400" y="630" width="200" height="30" rx="15" fill="rgba(0,255,136,0.2)" stroke="#00ff88" stroke-width="1"/>
                    <text x="500" y="650" text-anchor="middle" fill="#00ff88" font-size="12" font-weight="bold">✅ Closest Wall Found!</text>
                </svg>
            </div>
        </section>

    <section id="texture" class="advanced-section">
            <h2>🎨 Texture Mapping Process</h2>
            <div class="summary">
                <ul>
                    <li>Use hit offset to compute texture X (column in texture).</li>
                    <li>Wall height on screen shrinks as distance grows.</li>
                    <li>Sample texture column from draw_start → draw_end.</li>
                </ul>
            </div>
            <div class="flowchart">
                <svg viewBox="0 0 1000 800" style="width: 100%; height: auto; background: #0a0a0a; border-radius: 10px;">
                    <defs>
                        <linearGradient id="textureGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff6b6b;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#ffdd44;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#88ddff;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="stepGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#88ddff;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#4488cc;stop-opacity:1" />
                        </linearGradient>
                        <pattern id="brickPattern" patternUnits="userSpaceOnUse" width="20" height="10">
                            <rect width="20" height="10" fill="#cc6666"/>
                            <rect width="10" height="5" fill="#aa4444"/>
                            <rect x="10" y="5" width="10" height="5" fill="#aa4444"/>
                        </pattern>
                        <marker id="arrowhead3" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#ffffff"/>
                        </marker>
                    </defs>

                    <!-- Title -->
                    <text x="500" y="25" text-anchor="middle" fill="#ff6b6b" font-size="20" font-weight="bold">🎨 Texture Mapping Process</text>

                    <!-- Step 1: Calculate Texture X -->
                    <rect x="50" y="50" width="200" height="100" rx="10" fill="url(#stepGrad)" filter="url(#globalGlow)" stroke="#88ddff" stroke-width="2"/>
                    <text x="150" y="75" text-anchor="middle" fill="white" font-size="12" font-weight="bold">STEP 1</text>
                    <text x="150" y="95" text-anchor="middle" fill="white" font-size="11">Calculate Texture X</text>
                    <text x="150" y="115" text-anchor="middle" fill="white" font-size="10">offset = hit % TILE_SIZE</text>
                    <text x="150" y="130" text-anchor="middle" fill="white" font-size="10">tex_x = offset * tex_w / TILE</text>

                    <!-- Wall Texture Visualization -->
                    <g transform="translate(300, 60)">
                        <rect x="0" y="0" width="80" height="80" fill="url(#brickPattern)" stroke="#ffffff" stroke-width="2"/>
                        <text x="40" y="-5" text-anchor="middle" fill="white" font-size="10">Wall Texture (64x64)</text>
                        <circle cx="45" cy="40" r="3" fill="#ffdd44"/>
                        <text x="45" y="55" text-anchor="middle" fill="#ffdd44" font-size="8">Hit Point</text>
                        <line x1="45" y1="0" x2="45" y2="80" stroke="#ffdd44" stroke-width="2" stroke-dasharray="2,2"/>
                        <text x="50" y="95" fill="#ffdd44" font-size="9">tex_x = 45</text>
                    </g>

                    <!-- Step 2: Calculate Wall Height -->
                    <rect x="450" y="50" width="200" height="100" rx="10" fill="url(#stepGrad)" filter="url(#globalGlow)" stroke="#88ddff" stroke-width="2"/>
                    <text x="550" y="75" text-anchor="middle" fill="white" font-size="12" font-weight="bold">STEP 2</text>
                    <text x="550" y="95" text-anchor="middle" fill="white" font-size="11">Wall Height on Screen</text>
                    <text x="550" y="115" text-anchor="middle" fill="white" font-size="10">wall_h = TILE * SCREEN_H</text>
                    <text x="550" y="130" text-anchor="middle" fill="white" font-size="10">/ distance</text>

                    <!-- Distance comparison -->
                    <g transform="translate(700, 60)">
                        <!-- Close wall -->
                        <rect x="0" y="10" width="30" height="60" fill="#ff6b6b" stroke="#ffffff" stroke-width="1"/>
                        <text x="15" y="85" text-anchor="middle" fill="#ff6b6b" font-size="9">Close</text>
                        <text x="15" y="95" text-anchor="middle" fill="#ff6b6b" font-size="8">512px</text>

                        <!-- Far wall -->
                        <rect x="50" y="25" width="30" height="30" fill="#4488cc" stroke="#ffffff" stroke-width="1"/>
                        <text x="65" y="70" text-anchor="middle" fill="#4488cc" font-size="9">Far</text>
                        <text x="65" y="80" text-anchor="middle" fill="#4488cc" font-size="8">128px</text>
                    </g>

                    <!-- Step 3: Calculate Draw Bounds -->
                    <rect x="150" y="200" width="200" height="100" rx="10" fill="url(#stepGrad)" filter="url(#globalGlow)" stroke="#88ddff" stroke-width="2"/>
                    <text x="250" y="225" text-anchor="middle" fill="white" font-size="12" font-weight="bold">STEP 3</text>
                    <text x="250" y="245" text-anchor="middle" fill="white" font-size="11">Calculate Draw Bounds</text>
                    <text x="250" y="265" text-anchor="middle" fill="white" font-size="10">draw_start = center - h/2</text>
                    <text x="250" y="280" text-anchor="middle" fill="white" font-size="10">draw_end = center + h/2</text>

                    <!-- Screen visualization -->
                    <g transform="translate(400, 180)">
                        <rect x="0" y="0" width="40" height="120" fill="#333" stroke="#ffffff" stroke-width="2"/>
                        <text x="50" y="15" fill="white" font-size="10">Screen</text>
                        <text x="50" y="25" fill="white" font-size="8">(800px)</text>

                        <!-- Ceiling -->
                        <rect x="0" y="0" width="40" height="30" fill="#4488cc"/>
                        <text x="50" y="15" fill="#4488cc" font-size="8">Ceiling</text>

                        <!-- Wall -->
                        <rect x="0" y="30" width="40" height="60" fill="url(#brickPattern)"/>
                        <text x="50" y="65" fill="#ff6b6b" font-size="8">Wall</text>

                        <!-- Floor -->
                        <rect x="0" y="90" width="40" height="30" fill="#666"/>
                        <text x="50" y="110" fill="#888" font-size="8">Floor</text>

                        <!-- Draw bounds indicators -->
                        <line x1="-5" y1="30" x2="45" y2="30" stroke="#ffdd44" stroke-width="2"/>
                        <line x1="-5" y1="90" x2="45" y2="90" stroke="#ffdd44" stroke-width="2"/>
                        <text x="-20" y="35" fill="#ffdd44" font-size="8">start</text>
                        <text x="-20" y="95" fill="#ffdd44" font-size="8">end</text>
                    </g>

                    <!-- Step 4: Map Texture Y -->
                    <rect x="650" y="200" width="200" height="100" rx="10" fill="url(#stepGrad)" filter="url(#globalGlow)" stroke="#88ddff" stroke-width="2"/>
                    <text x="750" y="225" text-anchor="middle" fill="white" font-size="12" font-weight="bold">STEP 4</text>
                    <text x="750" y="245" text-anchor="middle" fill="white" font-size="11">Map Texture Y</text>
                    <text x="750" y="265" text-anchor="middle" fill="white" font-size="10">step = tex_h / wall_h</text>
                    <text x="750" y="280" text-anchor="middle" fill="white" font-size="10">tex_y = tex_pos % tex_h</text>

                    <!-- Texture mapping visualization -->
                    <g transform="translate(200, 350)">
                        <!-- Texture -->
                        <rect x="0" y="0" width="60" height="60" fill="url(#brickPattern)" stroke="#ffffff" stroke-width="2"/>
                        <text x="30" y="-10" text-anchor="middle" fill="white" font-size="10">Texture (64px)</text>

                        <!-- Arrow -->
                        <path d="M 80 30 L 120 30" stroke="#ffdd44" stroke-width="3" marker-end="url(#arrowhead3)"/>
                        <text x="100" y="25" text-anchor="middle" fill="#ffdd44" font-size="10">Map</text>

                        <!-- Screen column -->
                        <rect x="140" y="0" width="20" height="120" fill="url(#brickPattern)" stroke="#ffffff" stroke-width="2"/>
                        <text x="150" y="-10" text-anchor="middle" fill="white" font-size="10">Screen (200px)</text>

                        <!-- Mapping lines -->
                        <line x1="60" y1="15" x2="140" y2="30" stroke="#ffdd44" stroke-width="1"/>
                        <line x1="60" y1="30" x2="140" y2="60" stroke="#ffdd44" stroke-width="1"/>
                        <line x1="60" y1="45" x2="140" y2="90" stroke="#ffdd44" stroke-width="1"/>

                        <text x="100" y="140" text-anchor="middle" fill="#ffdd44" font-size="9">Each texture line → Multiple screen lines</text>
                    </g>

                    <!-- Step 5: Handle Flipping -->
                    <rect x="450" y="350" width="300" height="100" rx="10" fill="url(#stepGrad)" filter="url(#globalGlow)" stroke="#88ddff" stroke-width="2"/>
                    <text x="600" y="375" text-anchor="middle" fill="white" font-size="12" font-weight="bold">STEP 5: Handle Texture Flipping</text>
                    <text x="600" y="395" text-anchor="middle" fill="white" font-size="10">if (vertical && cos(angle) < 0) ||</text>
                    <text x="600" y="410" text-anchor="middle" fill="white" font-size="10">(!vertical && sin(angle) > 0):</text>
                    <text x="600" y="430" text-anchor="middle" fill="white" font-size="11">tex_x = tex_width - tex_x - 1</text>

                    <!-- Flipping visualization -->
                    <g transform="translate(100, 500)">
                        <text x="150" y="15" text-anchor="middle" fill="#ff6b6b" font-size="14" font-weight="bold">Texture Flipping</text>

                        <!-- Normal texture -->
                        <rect x="50" y="30" width="60" height="40" fill="url(#brickPattern)" stroke="#ffffff" stroke-width="2"/>
                        <text x="80" y="25" text-anchor="middle" fill="#00ff88" font-size="10">Normal</text>
                        <text x="80" y="85" text-anchor="middle" fill="#00ff88" font-size="9">✓ Correct</text>

                        <!-- Arrow -->
                        <path d="M 120 50 L 160 50" stroke="#ffdd44" stroke-width="2" marker-end="url(#arrowhead3)"/>
                        <text x="140" y="45" text-anchor="middle" fill="#ffdd44" font-size="9">Flip</text>

                        <!-- Flipped texture -->
                        <g transform="translate(240, 0)">
                            <rect x="0" y="30" width="60" height="40" fill="url(#brickPattern)" stroke="#ffffff" stroke-width="2" transform="scale(-1, 1) translate(-60, 0)"/>
                            <text x="30" y="25" text-anchor="middle" fill="#00ff88" font-size="10">Flipped</text>
                            <text x="30" y="85" text-anchor="middle" fill="#00ff88" font-size="9">✓ Correct</text>
                        </g>
                    </g>

                    <!-- Flow arrows -->
                    <line x1="150" y1="170" x2="250" y2="200" stroke="#88ddff" stroke-width="3" marker-end="url(#arrowhead3)"/>
                    <line x1="550" y1="170" x2="450" y2="200" stroke="#88ddff" stroke-width="3" marker-end="url(#arrowhead3)"/>
                    <line x1="350" y1="250" x2="650" y2="250" stroke="#88ddff" stroke-width="3" marker-end="url(#arrowhead3)"/>
                    <line x1="600" y1="320" x2="600" y2="350" stroke="#88ddff" stroke-width="3" marker-end="url(#arrowhead3)"/>

                    <!-- Final result -->
                    <rect x="350" y="650" width="300" height="60" rx="30" fill="url(#textureGrad)" filter="url(#globalGlow)" stroke="#ffffff" stroke-width="2"/>
                    <text x="500" y="685" text-anchor="middle" fill="white" font-size="16" font-weight="bold">🎯 Textured Wall Column Ready!</text>

                    <!-- Arrow to result -->
                    <line x1="500" y1="600" x2="500" y2="650" stroke="#00ff88" stroke-width="3" marker-end="url(#arrowhead3)"/>
                </svg>
            </div>
        </section>

    <section id="problems" class="advanced-section">
            <h2>🔧 Problem-Solution Flowcharts</h2>
            <div class="summary">
                <ul>
                    <li>Fisheye: multiply raw distance by cos(ray − player).</li>
                    <li>Gaps: clamp bounds, avoid precision traps, step carefully.</li>
                    <li>Div-by-zero: guard tan/cos/sin with small epsilon.</li>
                </ul>
            </div>

            <div class="flowchart">
                <svg viewBox="0 0 1000 600" style="width: 100%; height: auto; background: #0a0a0a; border-radius: 10px;">
                    <defs>
                        <linearGradient id="problemGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff6b6b;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#cc4444;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="solutionGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#00cc66;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="causeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffdd44;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#cc9922;stop-opacity:1" />
                        </linearGradient>
                        <marker id="arrowhead4" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#ffffff"/>
                        </marker>
                    </defs>

                    <!-- Problem 1: Fisheye Effect -->
                    <g transform="translate(50, 20)">
                        <text x="150" y="15" text-anchor="middle" fill="#ff6b6b" font-size="16" font-weight="bold">🐟 Problem 1: Fisheye Effect</text>

                        <!-- Problem -->
                        <rect x="50" y="30" width="200" height="50" rx="8" fill="url(#problemGrad)" filter="url(#globalGlow)" stroke="#ff6b6b" stroke-width="2"/>
                        <text x="150" y="50" text-anchor="middle" fill="white" font-size="12" font-weight="bold">❌ PROBLEM</text>
                        <text x="150" y="70" text-anchor="middle" fill="white" font-size="10">Curved walls • Bulging center</text>

                        <!-- Visual comparison -->
                        <g transform="translate(0, 90)">
                            <!-- Wrong (curved) -->
                            <g>
                                <text x="75" y="15" text-anchor="middle" fill="#ff6b6b" font-size="10">❌ Wrong (Fisheye)</text>
                                <path d="M 20 20 Q 75 40 130 20 Q 75 60 20 80 Q 75 60 130 80" fill="none" stroke="#ff6b6b" stroke-width="3"/>
                                <text x="75" y="100" text-anchor="middle" fill="#ff6b6b" font-size="9">Curved walls</text>
                            </g>

                            <!-- Right (flat) -->
                            <g transform="translate(170, 0)">
                                <text x="75" y="15" text-anchor="middle" fill="#00ff88" font-size="10">✅ Correct (Fixed)</text>
                                <line x1="20" y1="30" x2="130" y2="30" stroke="#00ff88" stroke-width="3"/>
                                <line x1="20" y1="50" x2="130" y2="50" stroke="#00ff88" stroke-width="3"/>
                                <line x1="20" y1="70" x2="130" y2="70" stroke="#00ff88" stroke-width="3"/>
                                <text x="75" y="100" text-anchor="middle" fill="#00ff88" font-size="9">Flat walls</text>
                            </g>
                        </g>

                        <!-- Cause -->
                        <rect x="50" y="210" width="200" height="50" rx="8" fill="url(#causeGrad)" filter="url(#globalGlow)" stroke="#ffdd44" stroke-width="2"/>
                        <text x="150" y="230" text-anchor="middle" fill="white" font-size="12" font-weight="bold">⚠️ CAUSE</text>
                        <text x="150" y="250" text-anchor="middle" fill="white" font-size="10">Using raw ray distances</text>

                        <!-- Solution -->
                        <rect x="50" y="290" width="200" height="70" rx="8" fill="url(#solutionGrad)" filter="url(#globalGlow)" stroke="#00ff88" stroke-width="2"/>
                        <text x="150" y="315" text-anchor="middle" fill="white" font-size="12" font-weight="bold">✅ SOLUTION</text>
                        <text x="150" y="335" text-anchor="middle" fill="white" font-size="10">corrected_dist = ray_dist ×</text>
                        <text x="150" y="350" text-anchor="middle" fill="white" font-size="10">cos(ray_angle - player_angle)</text>

                        <!-- Arrows -->
                        <line x1="150" y1="80" x2="150" y2="210" stroke="#ff6b6b" stroke-width="2" marker-end="url(#arrowhead4)"/>
                        <line x1="150" y1="260" x2="150" y2="290" stroke="#ffdd44" stroke-width="2" marker-end="url(#arrowhead4)"/>
                    </g>

                    <!-- Problem 2: Wall Gaps -->
                    <g transform="translate(350, 20)">
                        <text x="150" y="15" text-anchor="middle" fill="#ff6b6b" font-size="16" font-weight="bold">🕳️ Problem 2: Wall Gaps</text>

                        <!-- Problem -->
                        <rect x="50" y="30" width="200" height="50" rx="8" fill="url(#problemGrad)" filter="url(#globalGlow)" stroke="#ff6b6b" stroke-width="2"/>
                        <text x="150" y="50" text-anchor="middle" fill="white" font-size="12" font-weight="bold">❌ PROBLEM</text>
                        <text x="150" y="70" text-anchor="middle" fill="white" font-size="10">Black lines • Seeing through</text>

                        <!-- Visual gaps -->
                        <g transform="translate(60, 90)">
                            <text x="70" y="15" text-anchor="middle" fill="#ff6b6b" font-size="10">❌ With Gaps</text>
                            <!-- Grid with gaps -->
                            <rect x="10" y="20" width="30" height="30" fill="#666" stroke="#333" stroke-width="1"/>
                            <rect x="45" y="20" width="30" height="30" fill="#666" stroke="#333" stroke-width="1"/>
                            <rect x="80" y="20" width="30" height="30" fill="#666" stroke="#333" stroke-width="1"/>
                            <!-- Gaps -->
                            <line x1="40" y1="20" x2="40" y2="50" stroke="#000" stroke-width="2"/>
                            <line x1="75" y1="20" x2="75" y2="50" stroke="#000" stroke-width="2"/>
                            <text x="70" y="70" text-anchor="middle" fill="#ff6b6b" font-size="9">Gap artifacts</text>
                        </g>

                        <!-- Cause -->
                        <rect x="50" y="180" width="200" height="60" rx="8" fill="url(#causeGrad)" filter="url(#globalGlow)" stroke="#ffdd44" stroke-width="2"/>
                        <text x="150" y="200" text-anchor="middle" fill="white" font-size="12" font-weight="bold">⚠️ CAUSE</text>
                        <text x="150" y="220" text-anchor="middle" fill="white" font-size="10">Floating point precision</text>
                        <text x="150" y="235" text-anchor="middle" fill="white" font-size="9">63.99999 vs 64.00001</text>

                        <!-- Solution -->
                        <rect x="50" y="270" width="200" height="70" rx="8" fill="url(#solutionGrad)" filter="url(#globalGlow)" stroke="#00ff88" stroke-width="2"/>
                        <text x="150" y="295" text-anchor="middle" fill="white" font-size="12" font-weight="bold">✅ SOLUTION</text>
                        <text x="150" y="315" text-anchor="middle" fill="white" font-size="10">Add epsilon (1e-6)</text>
                        <text x="150" y="330" text-anchor="middle" fill="white" font-size="10">check(x, y ± epsilon)</text>

                        <!-- Arrows -->
                        <line x1="150" y1="80" x2="150" y2="180" stroke="#ff6b6b" stroke-width="2" marker-end="url(#arrowhead4)"/>
                        <line x1="150" y1="240" x2="150" y2="270" stroke="#ffdd44" stroke-width="2" marker-end="url(#arrowhead4)"/>
                    </g>

                    <!-- Problem 3: Division by Zero -->
                    <g transform="translate(650, 20)">
                        <text x="150" y="15" text-anchor="middle" fill="#ff6b6b" font-size="16" font-weight="bold">💥 Problem 3: Division by Zero</text>

                        <!-- Problem -->
                        <rect x="50" y="30" width="200" height="50" rx="8" fill="url(#problemGrad)" filter="url(#globalGlow)" stroke="#ff6b6b" stroke-width="2"/>
                        <text x="150" y="50" text-anchor="middle" fill="white" font-size="12" font-weight="bold">❌ PROBLEM</text>
                        <text x="150" y="70" text-anchor="middle" fill="white" font-size="10">Crash • Infinite loop • NaN</text>

                        <!-- Critical angles -->
                        <g transform="translate(70, 90)">
                            <text x="60" y="15" text-anchor="middle" fill="#ff6b6b" font-size="10">Critical Angles</text>
                            <circle cx="60" cy="40" r="25" fill="none" stroke="#ffdd44" stroke-width="2"/>
                            <!-- Angle markers -->
                            <line x1="60" y1="15" x2="60" y2="25" stroke="#ff6b6b" stroke-width="2"/>
                            <text x="65" y="10" fill="#ff6b6b" font-size="8">90°</text>
                            <line x1="85" y1="40" x2="75" y2="40" stroke="#ff6b6b" stroke-width="2"/>
                            <text x="90" y="35" fill="#ff6b6b" font-size="8">0°</text>
                            <line x1="60" y1="65" x2="60" y2="55" stroke="#ff6b6b" stroke-width="2"/>
                            <text x="65" y="75" fill="#ff6b6b" font-size="8">270°</text>
                            <line x1="35" y1="40" x2="45" y2="40" stroke="#ff6b6b" stroke-width="2"/>
                            <text x="25" y="35" fill="#ff6b6b" font-size="8">180°</text>
                        </g>

                        <!-- Cause -->
                        <rect x="50" y="180" width="200" height="60" rx="8" fill="url(#causeGrad)" filter="url(#globalGlow)" stroke="#ffdd44" stroke-width="2"/>
                        <text x="150" y="200" text-anchor="middle" fill="white" font-size="12" font-weight="bold">⚠️ CAUSE</text>
                        <text x="150" y="220" text-anchor="middle" fill="white" font-size="10">tan(π/2) = ∞</text>
                        <text x="150" y="235" text-anchor="middle" fill="white" font-size="10">cos(π/2) = 0</text>

                        <!-- Solution -->
                        <rect x="50" y="270" width="200" height="70" rx="8" fill="url(#solutionGrad)" filter="url(#globalGlow)" stroke="#00ff88" stroke-width="2"/>
                        <text x="150" y="295" text-anchor="middle" fill="white" font-size="12" font-weight="bold">✅ SOLUTION</text>
                        <text x="150" y="315" text-anchor="middle" fill="white" font-size="10">Check before dividing</text>
                        <text x="150" y="330" text-anchor="middle" fill="white" font-size="10">if (fabs(value) < 1e-9)</text>

                        <!-- Arrows -->
                        <line x1="150" y1="80" x2="150" y2="180" stroke="#ff6b6b" stroke-width="2" marker-end="url(#arrowhead4)"/>
                        <line x1="150" y1="240" x2="150" y2="270" stroke="#ffdd44" stroke-width="2" marker-end="url(#arrowhead4)"/>
                    </g>

                    <!-- Results Summary -->
                    <rect x="250" y="430" width="500" height="80" rx="15" fill="rgba(0,255,136,0.2)" stroke="#00ff88" stroke-width="3"/>
                    <text x="500" y="455" text-anchor="middle" fill="#00ff88" font-size="18" font-weight="bold">🎯 All Problems Solved!</text>
                    <text x="350" y="480" text-anchor="middle" fill="#00ff88" font-size="12">✅ Flat walls</text>
                    <text x="500" y="480" text-anchor="middle" fill="#00ff88" font-size="12">✅ Solid rendering</text>
                    <text x="650" y="480" text-anchor="middle" fill="#00ff88" font-size="12">✅ Stable execution</text>
                    <text x="350" y="495" text-anchor="middle" fill="#00ff88" font-size="12">✅ Correct depth</text>
                    <text x="500" y="495" text-anchor="middle" fill="#00ff88" font-size="12">✅ No flickering</text>
                    <text x="650" y="495" text-anchor="middle" fill="#00ff88" font-size="12">✅ Smooth rotation</text>

                    <!-- Arrows to summary -->
                    <line x1="200" y1="370" x2="350" y2="430" stroke="#00ff88" stroke-width="2" marker-end="url(#arrowhead4)"/>
                    <line x1="500" y1="380" x2="500" y2="430" stroke="#00ff88" stroke-width="2" marker-end="url(#arrowhead4)"/>
                    <line x1="800" y1="370" x2="650" y2="430" stroke="#00ff88" stroke-width="2" marker-end="url(#arrowhead4)"/>
                </svg>
            </div>
        </section>

    <section id="reference" class="advanced-section">
            <h2>🎯 Quick Reference Diagrams</h2>
            <div class="summary">
                <ul>
                    <li>Angles: 0°→East, 90°→North, 180°→West, 270°→South.</li>
                    <li>FOV spans the screen; cast one ray per column.</li>
                    <li>Pick texture by hit side (NS/EW) and ray direction.</li>
                </ul>
            </div>

            <div class="flowchart">
                <svg viewBox="0 0 1000 600" style="width: 100%; height: auto; background: #0a0a0a; border-radius: 10px; border: 2px solid #4dabf7;">
                    <defs>
                        <linearGradient id="refGrad1" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#74c0fc;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#339af0;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="refGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#a9e34b;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#74b816;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="refGrad3" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffec99;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#ffd43b;stop-opacity:1" />
                        </linearGradient>
                        <filter id="refGlow">
                            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                        <marker id="arrowRef" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#ffffff"/>
                        </marker>
                    </defs>

                    <!-- Title -->
                    <text x="500" y="30" text-anchor="middle" fill="#4dabf7" font-size="24" font-weight="bold">🧭 Quick Reference Diagrams</text>

                    <!-- Angle Reference Compass -->
                    <g transform="translate(50, 60)">
                        <rect x="0" y="0" width="220" height="220" rx="15" fill="url(#refGrad1)" filter="url(#refGlow)" stroke="#339af0" stroke-width="2"/>
                        <text x="110" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">🧭 Angle Reference</text>

                        <!-- Compass circle -->
                        <circle cx="110" cy="130" r="70" fill="none" stroke="#ffffff" stroke-width="3"/>

                        <!-- Cardinal directions -->
                        <g transform="translate(110, 130)">
                            <!-- North - 90° -->
                            <line x1="0" y1="-75" x2="0" y2="-65" stroke="#ffec99" stroke-width="4"/>
                            <text x="0" y="-80" text-anchor="middle" fill="#ffec99" font-size="14" font-weight="bold">90°</text>
                            <text x="0" y="-95" text-anchor="middle" fill="#ffec99" font-size="12">North ↑</text>

                            <!-- East - 0° -->
                            <line x1="75" y1="0" x2="65" y2="0" stroke="#ffec99" stroke-width="4"/>
                            <text x="85" y="5" text-anchor="middle" fill="#ffec99" font-size="14" font-weight="bold">0°</text>
                            <text x="85" y="-10" text-anchor="middle" fill="#ffec99" font-size="12">East →</text>

                            <!-- South - 270° -->
                            <line x1="0" y1="75" x2="0" y2="65" stroke="#ffec99" stroke-width="4"/>
                            <text x="0" y="90" text-anchor="middle" fill="#ffec99" font-size="14" font-weight="bold">270°</text>
                            <text x="0" y="105" text-anchor="middle" fill="#ffec99" font-size="12">South ↓</text>

                            <!-- West - 180° -->
                            <line x1="-75" y1="0" x2="-65" y2="0" stroke="#ffec99" stroke-width="4"/>
                            <text x="-85" y="5" text-anchor="middle" fill="#ffec99" font-size="14" font-weight="bold">180°</text>
                            <text x="-85" y="-10" text-anchor="middle" fill="#ffec99" font-size="12">← West</text>

                            <!-- Center point -->
                            <circle cx="0" cy="0" r="4" fill="#ff6b6b"/>

                            <!-- Angle arc example -->
                            <path d="M 20 0 A 20 20 0 0 0 14.14 14.14" fill="none" stroke="#ff6b6b" stroke-width="3"/>
                            <text x="25" y="15" fill="#ff6b6b" font-size="10">θ</text>
                        </g>
                    </g>

                    <!-- Ray Angles for Screen -->
                    <g transform="translate(300, 60)">
                        <rect x="0" y="0" width="300" height="220" rx="15" fill="url(#refGrad2)" filter="url(#refGlow)" stroke="#74b816" stroke-width="2"/>
                        <text x="150" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">📐 Ray Angles for Screen</text>

                        <!-- Screen representation -->
                        <rect x="50" y="50" width="200" height="20" fill="#333" stroke="#ffffff" stroke-width="2" rx="5"/>
                        <text x="150" y="45" text-anchor="middle" fill="white" font-size="12">Screen</text>

                        <!-- Screen divisions -->
                        <line x1="60" y1="50" x2="60" y2="70" stroke="#ffec99" stroke-width="2"/>
                        <line x1="150" y1="50" x2="150" y2="70" stroke="#ffec99" stroke-width="2"/>
                        <line x1="240" y1="50" x2="240" y2="70" stroke="#ffec99" stroke-width="2"/>

                        <!-- Labels -->
                        <text x="60" y="85" text-anchor="middle" fill="#ffec99" font-size="12" font-weight="bold">LEFT</text>
                        <text x="150" y="85" text-anchor="middle" fill="#ffec99" font-size="12" font-weight="bold">CENTER</text>
                        <text x="240" y="85" text-anchor="middle" fill="#ffec99" font-size="12" font-weight="bold">RIGHT</text>

                        <!-- Ray angles -->
                        <g transform="translate(150, 130)">
                            <!-- Player position -->
                            <circle cx="0" cy="0" r="6" fill="#ff6b6b"/>
                            <text x="0" y="-15" text-anchor="middle" fill="#ff6b6b" font-size="12" font-weight="bold">Player</text>

                            <!-- FOV rays -->
                            <line x1="0" y1="0" x2="-60" y2="-80" stroke="#ffec99" stroke-width="3"/>
                            <line x1="0" y1="0" x2="0" y2="-80" stroke="#ffec99" stroke-width="3"/>
                            <line x1="0" y1="0" x2="60" y2="-80" stroke="#ffec99" stroke-width="3"/>

                            <!-- Angle labels -->
                            <text x="-40" y="-60" fill="#ffec99" font-size="11">θ-FOV/2</text>
                            <text x="0" y="-65" text-anchor="middle" fill="#ffec99" font-size="11">θ</text>
                            <text x="40" y="-60" fill="#ffec99" font-size="11">θ+FOV/2</text>

                            <!-- Example -->
                            <text x="0" y="20" text-anchor="middle" fill="white" font-size="12" font-weight="bold">Example (FOV=60°, θ=90°):</text>
                            <text x="-40" y="35" fill="#a9e34b" font-size="11">60°</text>
                            <text x="0" y="35" text-anchor="middle" fill="#a9e34b" font-size="11">90°</text>
                            <text x="40" y="35" fill="#a9e34b" font-size="11">120°</text>
                        </g>
                    </g>

                    <!-- Collision Detection -->
                    <g transform="translate(630, 60)">
                        <rect x="0" y="0" width="320" height="220" rx="15" fill="url(#refGrad3)" filter="url(#refGlow)" stroke="#ffd43b" stroke-width="2"/>
                        <text x="160" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">🎯 Collision Detection</text>

                        <!-- Step 1: Check X -->
                        <rect x="20" y="45" width="280" height="50" rx="8" fill="rgba(255,255,255,0.3)" stroke="#ffffff" stroke-width="2"/>
                        <text x="160" y="65" text-anchor="middle" fill="white" font-size="14" font-weight="bold">1️⃣ Try move to (new_x, y)</text>
                        <text x="160" y="80" text-anchor="middle" fill="white" font-size="12">if safe: x = new_x</text>

                        <!-- Arrow -->
                        <line x1="160" y1="95" x2="160" y2="115" stroke="#ffd43b" stroke-width="3" marker-end="url(#arrowRef)"/>

                        <!-- Step 2: Check Y -->
                        <rect x="20" y="120" width="280" height="50" rx="8" fill="rgba(255,255,255,0.3)" stroke="#ffffff" stroke-width="2"/>
                        <text x="160" y="140" text-anchor="middle" fill="white" font-size="14" font-weight="bold">2️⃣ Try move to (x, new_y)</text>
                        <text x="160" y="155" text-anchor="middle" fill="white" font-size="12">if safe: y = new_y</text>

                        <!-- Benefits -->
                        <text x="160" y="185" text-anchor="middle" fill="white" font-size="12" font-weight="bold">✨ Benefits:</text>
                        <text x="160" y="200" text-anchor="middle" fill="white" font-size="11">Sliding • Smooth movement • Better feel</text>

                        <!-- Visual wall slide -->
                        <g transform="translate(250, 180)">
                            <rect x="0" y="0" width="40" height="8" fill="#666" stroke="#333"/>
                            <circle cx="15" cy="15" r="3" fill="#ff6b6b"/>
                            <path d="M 15 15 L 35 15" fill="none" stroke="#a9e34b" stroke-width="2" stroke-dasharray="2,2"/>
                            <text x="20" y="30" text-anchor="middle" fill="#a9e34b" font-size="8">Slide</text>
                        </g>
                    </g>

                    <!-- Texture Selection -->
                    <g transform="translate(200, 320)">
                        <rect x="0" y="0" width="600" height="220" rx="15" fill="linear-gradient(135deg, #845ef7, #5f3dc4)" filter="url(#refGlow)" stroke="#845ef7" stroke-width="2"/>
                        <text x="300" y="30" text-anchor="middle" fill="white" font-size="18" font-weight="bold">🎨 Texture Selection Guide</text>

                        <!-- Table headers -->
                        <rect x="30" y="50" width="140" height="35" rx="5" fill="rgba(255,255,255,0.2)" stroke="#ffffff" stroke-width="1"/>
                        <text x="100" y="73" text-anchor="middle" fill="white" font-size="14" font-weight="bold">Hit Type</text>

                        <rect x="180" y="50" width="140" height="35" rx="5" fill="rgba(255,255,255,0.2)" stroke="#ffffff" stroke-width="1"/>
                        <text x="250" y="73" text-anchor="middle" fill="white" font-size="14" font-weight="bold">Direction</text>

                        <rect x="330" y="50" width="140" height="35" rx="5" fill="rgba(255,255,255,0.2)" stroke="#ffffff" stroke-width="1"/>
                        <text x="400" y="73" text-anchor="middle" fill="white" font-size="14" font-weight="bold">Texture</text>

                        <rect x="480" y="50" width="90" height="35" rx="5" fill="rgba(255,255,255,0.2)" stroke="#ffffff" stroke-width="1"/>
                        <text x="525" y="73" text-anchor="middle" fill="white" font-size="14" font-weight="bold">Color</text>

                        <!-- Table rows -->
                        <!-- Row 1: Vertical East -->
                        <rect x="30" y="95" width="140" height="30" rx="5" fill="rgba(116,192,252,0.3)" stroke="#74c0fc" stroke-width="1"/>
                        <text x="100" y="115" text-anchor="middle" fill="white" font-size="12">Vertical</text>

                        <rect x="180" y="95" width="140" height="30" rx="5" fill="rgba(116,192,252,0.3)" stroke="#74c0fc" stroke-width="1"/>
                        <text x="250" y="115" text-anchor="middle" fill="white" font-size="12">cos(θ) > 0</text>

                        <rect x="330" y="95" width="140" height="30" rx="5" fill="rgba(116,192,252,0.3)" stroke="#74c0fc" stroke-width="1"/>
                        <text x="400" y="115" text-anchor="middle" fill="white" font-size="12" font-weight="bold">EAST</text>

                        <rect x="480" y="95" width="90" height="30" rx="5" fill="#74c0fc"/>

                        <!-- Row 2: Vertical West -->
                        <rect x="30" y="130" width="140" height="30" rx="5" fill="rgba(255,140,140,0.3)" stroke="#ff8c8c" stroke-width="1"/>
                        <text x="100" y="150" text-anchor="middle" fill="white" font-size="12">Vertical</text>

                        <rect x="180" y="130" width="140" height="30" rx="5" fill="rgba(255,140,140,0.3)" stroke="#ff8c8c" stroke-width="1"/>
                        <text x="250" y="150" text-anchor="middle" fill="white" font-size="12">cos(θ) < 0</text>

                        <rect x="330" y="130" width="140" height="30" rx="5" fill="rgba(255,140,140,0.3)" stroke="#ff8c8c" stroke-width="1"/>
                        <text x="400" y="150" text-anchor="middle" fill="white" font-size="12" font-weight="bold">WEST</text>

                        <rect x="480" y="130" width="90" height="30" rx="5" fill="#ff8c8c"/>

                        <!-- Row 3: Horizontal North -->
                        <rect x="30" y="165" width="140" height="30" rx="5" fill="rgba(169,227,75,0.3)" stroke="#a9e34b" stroke-width="1"/>
                        <text x="100" y="185" text-anchor="middle" fill="white" font-size="12">Horizontal</text>

                        <rect x="180" y="165" width="140" height="30" rx="5" fill="rgba(169,227,75,0.3)" stroke="#a9e34b" stroke-width="1"/>
                        <text x="250" y="185" text-anchor="middle" fill="white" font-size="12">sin(θ) > 0</text>

                        <rect x="330" y="165" width="140" height="30" rx="5" fill="rgba(169,227,75,0.3)" stroke="#a9e34b" stroke-width="1"/>
                        <text x="400" y="185" text-anchor="middle" fill="white" font-size="12" font-weight="bold">NORTH</text>

                        <rect x="480" y="165" width="90" height="30" rx="5" fill="#a9e34b"/>

                        <!-- Row 4: Horizontal South -->
                        <rect x="30" y="200" width="140" height="30" rx="5" fill="rgba(255,236,153,0.3)" stroke="#ffec99" stroke-width="1"/>
                        <text x="100" y="220" text-anchor="middle" fill="white" font-size="12">Horizontal</text>

                        <rect x="180" y="200" width="140" height="30" rx="5" fill="rgba(255,236,153,0.3)" stroke="#ffec99" stroke-width="1"/>
                        <text x="250" y="220" text-anchor="middle" fill="white" font-size="12">sin(θ) < 0</text>

                        <rect x="330" y="200" width="140" height="30" rx="5" fill="rgba(255,236,153,0.3)" stroke="#ffec99" stroke-width="1"/>
                        <text x="400" y="220" text-anchor="middle" fill="white" font-size="12" font-weight="bold">SOUTH</text>

                        <rect x="480" y="200" width="90" height="30" rx="5" fill="#ffec99"/>
                    </g>
                </svg>
            </div>
        </section>

    <section id="mathematical" class="advanced-section">
            <h2>📐 Mathematical Formulas</h2>
            <div class="summary">
                <ul>
                    <li>Euclidean distance → projected with cos correction to avoid fisheye.</li>
                    <li>Wall height ∝ 1 / distance; texture Y uses step = tex_h / wall_h.</li>
                    <li>Texture X is (hit % tile_size) scaled to texture width.</li>
                </ul>
            </div>

            <div class="flowchart">
                <svg viewBox="0 0 1000 800" style="width: 100%; height: auto; background: #0a0a0a; border-radius: 15px; border: 3px solid #ffdd44;">
                    <defs>
                        <linearGradient id="mathGrad1" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffd43b;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fab005;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="mathGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#74c0fc;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#1c7ed6;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="mathGrad3" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#69db7c;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#37b24d;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="mathGrad4" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffa8a8;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#f03e3e;stop-opacity:1" />
                        </linearGradient>
                        <filter id="mathGlow">
                            <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                        <marker id="mathArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#ffffff"/>
                        </marker>
                    </defs>

                    <!-- Title -->
                    <text x="500" y="35" text-anchor="middle" fill="#ffd43b" font-size="26" font-weight="bold">🧮 Mathematical Formula Visualizations</text>

                    <!-- Distance Calculation -->
                    <g transform="translate(50, 70)">
                        <rect x="0" y="0" width="400" height="180" rx="15" fill="url(#mathGrad1)" filter="url(#mathGlow)" stroke="#ffd43b" stroke-width="3"/>
                        <text x="200" y="30" text-anchor="middle" fill="white" font-size="18" font-weight="bold">📏 Distance Calculation</text>

                        <!-- Formula -->
                        <rect x="20" y="45" width="360" height="40" rx="8" fill="rgba(255,255,255,0.2)" stroke="#ffffff" stroke-width="2"/>
                        <text x="200" y="70" text-anchor="middle" fill="white" font-size="16" font-family="serif">Distance = √[(x₂-x₁)² + (y₂-y₁)²]</text>

                        <!-- Visual representation -->
                        <g transform="translate(50, 100)">
                            <circle cx="50" cy="50" r="4" fill="#ffec99"/>
                            <text x="50" y="42" text-anchor="middle" fill="#ffec99" font-size="12">(x₁,y₁)</text>

                            <circle cx="250" cy="20" r="4" fill="#ffec99"/>
                            <text x="250" y="12" text-anchor="middle" fill="#ffec99" font-size="12">(x₂,y₂)</text>

                            <line x1="50" y1="50" x2="250" y2="20" stroke="#ffffff" stroke-width="3"/>
                            <text x="150" y="30" text-anchor="middle" fill="#ffffff" font-size="14" font-weight="bold">distance</text>

                            <!-- Triangle -->
                            <line x1="50" y1="50" x2="250" y2="50" stroke="#ffec99" stroke-width="2" stroke-dasharray="3,3"/>
                            <line x1="250" y1="50" x2="250" y2="20" stroke="#ffec99" stroke-width="2" stroke-dasharray="3,3"/>

                            <text x="150" y="65" text-anchor="middle" fill="#ffec99" font-size="12">x₂-x₁</text>
                            <text x="265" y="35" text-anchor="middle" fill="#ffec99" font-size="12">y₂-y₁</text>
                        </g>

                        <!-- Code -->
                        <rect x="20" y="155" width="360" height="20" rx="5" fill="rgba(0,0,0,0.4)" stroke="#333" stroke-width="1"/>
                        <text x="200" y="169" text-anchor="middle" fill="#69db7c" font-size="12" font-family="monospace">distance = hypot(hit_x - player_x, hit_y - player_y);</text>
                    </g>

                    <!-- Wall Height Calculation -->
                    <g transform="translate(500, 70)">
                        <rect x="0" y="0" width="400" height="180" rx="15" fill="url(#mathGrad2)" filter="url(#mathGlow)" stroke="#74c0fc" stroke-width="3"/>
                        <text x="200" y="30" text-anchor="middle" fill="white" font-size="18" font-weight="bold">📐 Wall Height</text>

                        <!-- Formula -->
                        <rect x="20" y="45" width="360" height="40" rx="8" fill="rgba(255,255,255,0.2)" stroke="#ffffff" stroke-width="2"/>
                        <text x="200" y="65" text-anchor="middle" fill="white" font-size="14" font-family="serif">wall_height = (TILE_SIZE × SCREEN_HEIGHT)</text>
                        <text x="200" y="80" text-anchor="middle" fill="white" font-size="14" font-family="serif">/ distance</text>

                        <!-- Visual relationship -->
                        <g transform="translate(50, 100)">
                            <!-- Near wall (tall) -->
                            <rect x="50" y="20" width="15" height="60" fill="#74c0fc" stroke="#ffffff"/>
                            <text x="57" y="90" text-anchor="middle" fill="#74c0fc" font-size="10">Near</text>
                            <text x="57" y="105" text-anchor="middle" fill="#74c0fc" font-size="10">Small dist</text>
                            <text x="57" y="120" text-anchor="middle" fill="#74c0fc" font-size="10">Tall wall</text>

                            <!-- Medium wall -->
                            <rect x="150" y="35" width="15" height="30" fill="#74c0fc" stroke="#ffffff"/>
                            <text x="157" y="75" text-anchor="middle" fill="#74c0fc" font-size="10">Medium</text>

                            <!-- Far wall (short) -->
                            <rect x="250" y="50" width="15" height="15" fill="#74c0fc" stroke="#ffffff"/>
                            <text x="257" y="75" text-anchor="middle" fill="#74c0fc" font-size="10">Far</text>
                            <text x="257" y="90" text-anchor="middle" fill="#74c0fc" font-size="10">Large dist</text>
                            <text x="257" y="105" text-anchor="middle" fill="#74c0fc" font-size="10">Short wall</text>

                            <!-- Arrows showing relationship -->
                            <path d="M 80 40 Q 115 25 140 35" fill="none" stroke="#ffec99" stroke-width="2" marker-end="url(#mathArrow)"/>
                            <path d="M 180 50 Q 215 35 240 50" fill="none" stroke="#ffec99" stroke-width="2" marker-end="url(#mathArrow)"/>
                        </g>
                    </g>

                    <!-- Fisheye Correction -->
                    <g transform="translate(50, 280)">
                        <rect x="0" y="0" width="400" height="180" rx="15" fill="url(#mathGrad3)" filter="url(#mathGlow)" stroke="#69db7c" stroke-width="3"/>
                        <text x="200" y="30" text-anchor="middle" fill="white" font-size="18" font-weight="bold">🐟 Fisheye Correction</text>

                        <!-- Formula -->
                        <rect x="20" y="45" width="360" height="40" rx="8" fill="rgba(255,255,255,0.2)" stroke="#ffffff" stroke-width="2"/>
                        <text x="200" y="65" text-anchor="middle" fill="white" font-size="14" font-family="serif">corrected_distance = raw_distance × cos(Δθ)</text>
                        <text x="200" y="80" text-anchor="middle" fill="#ffec99" font-size="12">where: Δθ = ray_angle - player_angle</text>

                        <!-- Visual correction -->
                        <g transform="translate(50, 100)">
                            <!-- Player -->
                            <circle cx="50" cy="40" r="6" fill="#ff6b6b"/>
                            <text x="50" y="30" text-anchor="middle" fill="#ff6b6b" font-size="12">Player</text>

                            <!-- Rays -->
                            <line x1="50" y1="40" x2="150" y2="20" stroke="#ff6b6b" stroke-width="3"/>
                            <line x1="50" y1="40" x2="200" y2="40" stroke="#69db7c" stroke-width="3"/>
                            <line x1="50" y1="40" x2="150" y2="60" stroke="#ff6b6b" stroke-width="3"/>

                            <!-- Angle arc -->
                            <path d="M 65 40 A 15 15 0 0 0 60 30" fill="none" stroke="#ffec99" stroke-width="2"/>
                            <text x="75" y="32" fill="#ffec99" font-size="10">Δθ</text>

                            <!-- Wall -->
                            <line x1="250" y1="0" x2="250" y2="80" stroke="#ffffff" stroke-width="4"/>
                            <text x="255" y="45" fill="#ffffff" font-size="12">Wall</text>

                            <!-- Distance labels -->
                            <text x="100" y="25" fill="#ff6b6b" font-size="10">raw_dist</text>
                            <text x="125" y="45" fill="#69db7c" font-size="10">corrected</text>
                        </g>
                    </g>

                    <!-- Texture Mapping -->
                    <g transform="translate(500, 280)">
                        <rect x="0" y="0" width="400" height="180" rx="15" fill="url(#mathGrad4)" filter="url(#mathGlow)" stroke="#ffa8a8" stroke-width="3"/>
                        <text x="200" y="30" text-anchor="middle" fill="white" font-size="18" font-weight="bold">🎨 Texture Mapping</text>

                        <!-- Formulas -->
                        <rect x="20" y="45" width="360" height="60" rx="8" fill="rgba(255,255,255,0.2)" stroke="#ffffff" stroke-width="2"/>
                        <text x="200" y="65" text-anchor="middle" fill="white" font-size="12" font-family="serif">tex_x = (hit_pos % TILE_SIZE) × tex_width / TILE_SIZE</text>
                        <text x="200" y="80" text-anchor="middle" fill="white" font-size="12" font-family="serif">tex_y = screen_y × tex_height / wall_height</text>
                        <text x="200" y="95" text-anchor="middle" fill="white" font-size="12" font-family="serif">step = tex_height / wall_height</text>

                        <!-- Visual mapping -->
                        <g transform="translate(50, 115)">
                            <!-- Wall slice -->
                            <rect x="50" y="0" width="20" height="60" fill="url(#mathGrad4)" stroke="#ffffff" stroke-width="2"/>
                            <text x="60" y="75" text-anchor="middle" fill="#ffa8a8" font-size="10">Wall slice</text>

                            <!-- Texture -->
                            <g transform="translate(150, 10)">
                                <rect x="0" y="0" width="40" height="40" fill="#666" stroke="#333"/>
                                <rect x="0" y="0" width="20" height="20" fill="#999"/>
                                <rect x="20" y="20" width="20" height="20" fill="#999"/>
                                <text x="20" y="50" text-anchor="middle" fill="#ffa8a8" font-size="10">Texture</text>
                            </g>

                            <!-- Mapping arrows -->
                            <path d="M 75 30 Q 100 25 140 25" fill="none" stroke="#ffec99" stroke-width="2" marker-end="url(#mathArrow)"/>
                            <text x="100" y="20" text-anchor="middle" fill="#ffec99" font-size="9">mapping</text>

                            <!-- Screen column -->
                            <rect x="250" y="10" width="8" height="40" fill="#74c0fc" stroke="#ffffff"/>
                            <text x="254" y="60" text-anchor="middle" fill="#74c0fc" font-size="10">Screen</text>
                        </g>
                    </g>

                    <!-- Performance Tips -->
                    <g transform="translate(200, 500)">
                        <rect x="0" y="0" width="600" height="120" rx="15" fill="linear-gradient(135deg, rgba(0,255,136,0.2), rgba(0,255,136,0.1))" stroke="#00ff88" stroke-width="3"/>
                        <text x="300" y="30" text-anchor="middle" fill="#00ff88" font-size="20" font-weight="bold">⚡ Performance Tips</text>

                        <g transform="translate(40, 50)">
                            <circle cx="15" cy="15" r="8" fill="#00ff88"/>
                            <text x="15" y="20" text-anchor="middle" fill="white" font-size="12" font-weight="bold">1</text>
                            <text x="35" y="20" fill="white" font-size="14">Use lookup tables for trigonometric functions</text>

                            <circle cx="285" cy="15" r="8" fill="#00ff88"/>
                            <text x="285" y="20" text-anchor="middle" fill="white" font-size="12" font-weight="bold">2</text>
                            <text x="305" y="20" fill="white" font-size="14">Cache calculated distances</text>

                            <circle cx="15" cy="45" r="8" fill="#00ff88"/>
                            <text x="15" y="50" text-anchor="middle" fill="white" font-size="12" font-weight="bold">3</text>
                            <text x="35" y="50" fill="white" font-size="14">Use integer arithmetic where possible</text>

                            <circle cx="285" cy="45" r="8" fill="#00ff88"/>
                            <text x="285" y="50" text-anchor="middle" fill="white" font-size="12" font-weight="bold">4</text>
                            <text x="305" y="50" fill="white" font-size="14">Optimize texture sampling</text>
                        </g>
                    </g>

                    <!-- Mathematical relationships -->
                    <g transform="translate(100, 650)">
                        <rect x="0" y="0" width="800" height="100" rx="15" fill="rgba(255,221,68,0.15)" stroke="#ffdd44" stroke-width="2"/>
                        <text x="400" y="25" text-anchor="middle" fill="#ffdd44" font-size="18" font-weight="bold">🔗 Key Mathematical Relationships</text>

                        <text x="120" y="50" text-anchor="middle" fill="white" font-size="12">Distance ↑ → Height ↓</text>
                        <text x="280" y="50" text-anchor="middle" fill="white" font-size="12">Angle ↑ → Correction ↓</text>
                        <text x="500" y="50" text-anchor="middle" fill="white" font-size="12">FOV ↑ → Step ↑</text>
                        <text x="680" y="50" text-anchor="middle" fill="white" font-size="12">Speed ↑ → Precision ↓</text>

                        <text x="120" y="70" text-anchor="middle" fill="#88ddff" font-size="11">(Perspective)</text>
                        <text x="280" y="70" text-anchor="middle" fill="#88ddff" font-size="11">(Fisheye)</text>
                        <text x="500" y="70" text-anchor="middle" fill="#88ddff" font-size="11">(Ray casting)</text>
                        <text x="680" y="70" text-anchor="middle" fill="#88ddff" font-size="11">(Performance)</text>
                    </g>
                </svg>
            </div>
        </section>

    <section id="input-output" class="advanced-section">
            <h2>🎮 Input to Output Flow</h2>
            <div class="summary">
                <ul>
                    <li>Key press → set flags → compute new position.</li>
                    <li>Validate via collision checks; apply safe movement.</li>
                    <li>Raycast, draw, and display the new frame.</li>
                </ul>
            </div>
            <div class="flowchart">
                <svg viewBox="0 0 1000 900" style="width: 100%; height: auto; background: #0a0a0a; border-radius: 15px; border: 3px solid #88ddff;">
                    <defs>
                        <linearGradient id="inputGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff6b6b;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#cc4444;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="processGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#74c0fc;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#1c7ed6;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="outputGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#69db7c;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#37b24d;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="validationGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffd43b;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fab005;stop-opacity:1" />
                        </linearGradient>
                        <filter id="flowGlow">
                            <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                        <marker id="flowArrow" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
                            <polygon points="0 0, 12 4, 0 8" fill="#ffffff"/>
                        </marker>
                        <pattern id="keyPattern" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
                            <rect width="20" height="20" fill="#2a2a2a"/>
                            <rect x="2" y="2" width="16" height="16" fill="#444" rx="2"/>
                        </pattern>
                    </defs>

                    <!-- Title -->
                    <text x="500" y="35" text-anchor="middle" fill="#88ddff" font-size="26" font-weight="bold">🎮 Complete Input to Output Pipeline</text>

                    <!-- Step 1: Input -->
                    <g transform="translate(350, 70)">
                        <rect x="0" y="0" width="300" height="80" rx="15" fill="url(#inputGrad)" filter="url(#flowGlow)" stroke="#ff6b6b" stroke-width="3"/>

                        <!-- Keyboard visual -->
                        <rect x="20" y="20" width="60" height="40" rx="8" fill="url(#keyPattern)" stroke="#ffffff" stroke-width="2"/>
                        <text x="50" y="45" text-anchor="middle" fill="#ffffff" font-size="24" font-weight="bold">W</text>

                        <text x="200" y="35" text-anchor="middle" fill="white" font-size="18" font-weight="bold">🎯 INPUT</text>
                        <text x="200" y="55" text-anchor="middle" fill="white" font-size="14">Key Press Detected</text>
                        <text x="200" y="70" text-anchor="middle" fill="#ffec99" font-size="12">User wants to move forward</text>
                    </g>

                    <!-- Arrow 1 -->
                    <line x1="500" y1="150" x2="500" y2="180" stroke="#ffffff" stroke-width="4" marker-end="url(#flowArrow)"/>
                    <circle cx="500" cy="165" r="8" fill="#ff6b6b">
                        <animate attributeName="r" values="8;12;8" dur="2s" repeatCount="indefinite"/>
                    </circle>

                    <!-- Step 2: Flag Set -->
                    <g transform="translate(350, 190)">
                        <rect x="0" y="0" width="300" height="80" rx="15" fill="url(#processGrad)" filter="url(#flowGlow)" stroke="#74c0fc" stroke-width="3"/>

                        <!-- Flag visual -->
                        <g transform="translate(30, 25)">
                            <rect x="0" y="0" width="50" height="30" rx="5" fill="#00ff88" stroke="#ffffff" stroke-width="2"/>
                            <text x="25" y="20" text-anchor="middle" fill="white" font-size="12" font-weight="bold">k_up = 1</text>
                        </g>

                        <text x="200" y="35" text-anchor="middle" fill="white" font-size="18" font-weight="bold">🚩 FLAG SET</text>
                        <text x="200" y="55" text-anchor="middle" fill="white" font-size="14">Movement Flag Activated</text>
                        <text x="200" y="70" text-anchor="middle" fill="#ffec99" font-size="12">System ready to process movement</text>
                    </g>

                    <!-- Arrow 2 -->
                    <line x1="500" y1="270" x2="500" y2="300" stroke="#ffffff" stroke-width="4" marker-end="url(#flowArrow)"/>
                    <circle cx="500" cy="285" r="8" fill="#74c0fc">
                        <animate attributeName="r" values="8;12;8" dur="2s" repeatCount="indefinite"/>
                    </circle>

                    <!-- Step 3: Calculate -->
                    <g transform="translate(250, 310)">
                        <rect x="0" y="0" width="500" height="100" rx="15" fill="url(#processGrad)" filter="url(#flowGlow)" stroke="#74c0fc" stroke-width="3"/>

                        <!-- Math visualization -->
                        <g transform="translate(30, 25)">
                            <circle cx="25" cy="25" r="15" fill="#ffd43b" stroke="#ffffff" stroke-width="2"/>
                            <text x="25" y="30" text-anchor="middle" fill="black" font-size="12" font-weight="bold">θ</text>

                            <!-- Vector arrows -->
                            <line x1="25" y1="25" x2="80" y2="10" stroke="#00ff88" stroke-width="3" marker-end="url(#flowArrow)"/>
                            <line x1="25" y1="25" x2="80" y2="40" stroke="#ff6b6b" stroke-width="3" marker-end="url(#flowArrow)"/>

                            <text x="85" y="8" fill="#00ff88" font-size="10">cos(θ)×speed</text>
                            <text x="85" y="45" fill="#ff6b6b" font-size="10">sin(θ)×speed</text>
                        </g>

                        <text x="300" y="35" text-anchor="middle" fill="white" font-size="18" font-weight="bold">🧮 CALCULATE</text>
                        <text x="300" y="55" text-anchor="middle" fill="white" font-size="14">new_x = x + cos(θ)×speed</text>
                        <text x="300" y="75" text-anchor="middle" fill="white" font-size="14">new_y = y + sin(θ)×speed</text>
                        <text x="300" y="90" text-anchor="middle" fill="#ffec99" font-size="12">Compute potential new position</text>
                    </g>

                    <!-- Arrow 3 -->
                    <line x1="500" y1="410" x2="500" y2="440" stroke="#ffffff" stroke-width="4" marker-end="url(#flowArrow)"/>
                    <circle cx="500" cy="425" r="8" fill="#ffd43b">
                        <animate attributeName="r" values="8;12;8" dur="2s" repeatCount="indefinite"/>
                    </circle>

                    <!-- Step 4: Validate -->
                    <g transform="translate(350, 450)">
                        <rect x="0" y="0" width="300" height="80" rx="15" fill="url(#validationGrad)" filter="url(#flowGlow)" stroke="#ffd43b" stroke-width="3"/>

                        <!-- Collision check visual -->
                        <g transform="translate(30, 25)">
                            <rect x="0" y="0" width="20" height="30" fill="#666" stroke="#333"/>
                            <circle cx="35" cy="15" r="8" fill="#ffd43b" stroke="#ffffff" stroke-width="2"/>
                            <text x="35" y="20" text-anchor="middle" fill="white" font-size="10">?</text>
                            <text x="60" y="35" fill="#ffd43b" font-size="8">Check</text>
                        </g>

                        <text x="200" y="35" text-anchor="middle" fill="white" font-size="18" font-weight="bold">✅ VALIDATE</text>
                        <text x="200" y="55" text-anchor="middle" fill="white" font-size="14">Collision Detection</text>
                        <text x="200" y="70" text-anchor="middle" fill="#000" font-size="12">Is new position safe?</text>
                    </g>

                    <!-- Arrow 4 -->
                    <line x1="500" y1="530" x2="500" y2="560" stroke="#ffffff" stroke-width="4" marker-end="url(#flowArrow)"/>
                    <circle cx="500" cy="545" r="8" fill="#00ff88">
                        <animate attributeName="r" values="8;12;8" dur="2s" repeatCount="indefinite"/>
                    </circle>

                    <!-- Step 5: Apply -->
                    <g transform="translate(350, 570)">
                        <rect x="0" y="0" width="300" height="80" rx="15" fill="url(#outputGrad)" filter="url(#flowGlow)" stroke="#69db7c" stroke-width="3"/>

                        <!-- Position update visual -->
                        <g transform="translate(30, 25)">
                            <circle cx="15" cy="15" r="8" fill="#ff6b6b" stroke="#ffffff" stroke-width="2"/>
                            <text x="15" y="28" text-anchor="middle" fill="#ff6b6b" font-size="8">old</text>

                            <line x1="30" y1="15" x2="45" y2="15" stroke="#ffffff" stroke-width="2" marker-end="url(#flowArrow)"/>
                            <text x="37" y="10" text-anchor="middle" fill="#ffffff" font-size="8">move</text>

                            <circle cx="60" cy="15" r="8" fill="#00ff88" stroke="#ffffff" stroke-width="2"/>
                            <text x="60" y="28" text-anchor="middle" fill="#00ff88" font-size="8">new</text>
                        </g>

                        <text x="200" y="35" text-anchor="middle" fill="white" font-size="18" font-weight="bold">📍 APPLY</text>
                        <text x="200" y="55" text-anchor="middle" fill="white" font-size="14">Update Position</text>
                        <text x="200" y="70" text-anchor="middle" fill="#ffec99" font-size="12">Player moved to new location</text>
                    </g>

                    <!-- Arrow 5 -->
                    <line x1="500" y1="650" x2="500" y2="680" stroke="#ffffff" stroke-width="4" marker-end="url(#flowArrow)"/>
                    <circle cx="500" cy="665" r="8" fill="#69db7c">
                        <animate attributeName="r" values="8;12;8" dur="2s" repeatCount="indefinite"/>
                    </circle>

                    <!-- Step 6: Render -->
                    <g transform="translate(200, 690)">
                        <rect x="0" y="0" width="600" height="100" rx="15" fill="url(#outputGrad)" filter="url(#flowGlow)" stroke="#69db7c" stroke-width="3"/>

                        <!-- Raycast visual -->
                        <g transform="translate(30, 25)">
                            <circle cx="25" cy="25" r="8" fill="#ff6b6b"/>
                            <!-- Multiple rays -->
                            <line x1="25" y1="25" x2="100" y2="10" stroke="#ffec99" stroke-width="2" stroke-dasharray="3,3"/>
                            <line x1="25" y1="25" x2="100" y2="25" stroke="#ffec99" stroke-width="2" stroke-dasharray="3,3"/>
                            <line x1="25" y1="25" x2="100" y2="40" stroke="#ffec99" stroke-width="2" stroke-dasharray="3,3"/>
                            <line x1="25" y1="25" x2="100" y2="55" stroke="#ffec99" stroke-width="2" stroke-dasharray="3,3"/>

                            <!-- Screen -->
                            <rect x="120" y="10" width="80" height="50" fill="#333" stroke="#ffffff" stroke-width="2" rx="5"/>
                            <rect x="125" y="15" width="70" height="40" fill="#000" stroke="#69db7c" stroke-width="1"/>

                            <!-- Rendered scene -->
                            <rect x="130" y="25" width="10" height="20" fill="#74c0fc"/>
                            <rect x="145" y="30" width="10" height="10" fill="#ffd43b"/>
                            <rect x="160" y="20" width="10" height="30" fill="#ff6b6b"/>
                            <rect x="175" y="35" width="10" height="5" fill="#69db7c"/>

                            <text x="165" y="70" text-anchor="middle" fill="#69db7c" font-size="10">New View</text>
                        </g>

                        <text x="350" y="35" text-anchor="middle" fill="white" font-size="18" font-weight="bold">🎨 RENDER</text>
                        <text x="350" y="55" text-anchor="middle" fill="white" font-size="14">Cast Rays & Generate View</text>
                        <text x="350" y="75" text-anchor="middle" fill="white" font-size="14">Display Updated Scene</text>
                        <text x="350" y="90" text-anchor="middle" fill="#ffec99" font-size="12">Complete rendering pipeline executed</text>
                    </g>

                    <!-- Performance metrics -->
                    <g transform="translate(50, 820)">
                        <rect x="0" y="0" width="900" height="60" rx="12" fill="rgba(136,221,255,0.2)" stroke="#88ddff" stroke-width="2"/>
                        <text x="450" y="25" text-anchor="middle" fill="#88ddff" font-size="16" font-weight="bold">⚡ Performance: Input → Output in ~16ms (60 FPS)</text>

                        <!-- Timing breakdown -->
                        <text x="120" y="45" text-anchor="middle" fill="white" font-size="12">Input: <tspan fill="#ff6b6b">0.1ms</tspan></text>
                        <text x="280" y="45" text-anchor="middle" fill="white" font-size="12">Calculate: <tspan fill="#74c0fc">0.2ms</tspan></text>
                        <text x="450" y="45" text-anchor="middle" fill="white" font-size="12">Validate: <tspan fill="#ffd43b">0.5ms</tspan></text>
                        <text x="620" y="45" text-anchor="middle" fill="white" font-size="12">Render: <tspan fill="#69db7c">15ms</tspan></text>
                        <text x="780" y="45" text-anchor="middle" fill="white" font-size="12">Display: <tspan fill="#69db7c">0.2ms</tspan></text>
                    </g>
                </svg>
            </div>
        </section>

    <section id="example" class="advanced-section">
            <h2>🏆 Complete Example: Single Ray</h2>
            <div class="summary">
                <ul>
                    <li>Compute ray angle for a screen column.</li>
                    <li>DDA to nearest hit → fisheye-corrected distance.</li>
                    <li>Pick texture, compute wall height, draw one strip.</li>
                </ul>
            </div>
            <div class="flowchart">
                <div class="formula-container">
                    <svg viewBox="0 0 1000 1000" style="width: 100%; height: auto; background: #0a0a0a; border-radius: 15px; border: 3px solid #00ff88;">
                        <defs>
                            <linearGradient id="exampleGrad1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#00cc66;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="exampleGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#74c0fc;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#1c7ed6;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="exampleGrad3" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#ffd43b;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#fab005;stop-opacity:1" />
                            </linearGradient>
                            <filter id="exampleGlow">
                                <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                                <feMerge>
                                    <feMergeNode in="coloredBlur"/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                            <marker id="exampleArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#ffffff"/>
                            </marker>
                        </defs>

                        <!-- Title -->
                        <text x="500" y="35" text-anchor="middle" fill="#00ff88" font-size="24" font-weight="bold">🎯 Interactive Example: Complete Ray Trace</text>

                        <!-- Input Parameters -->
                        <g transform="translate(50, 60)">
                            <rect x="0" y="0" width="400" height="120" rx="12" fill="url(#exampleGrad1)" filter="url(#exampleGlow)" stroke="#00ff88" stroke-width="2"/>
                            <text x="200" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">📊 INPUT PARAMETERS</text>

                            <text x="30" y="50" fill="white" font-size="14">Player Position: <tspan fill="#ffec99">(200, 200)</tspan></text>
                            <text x="30" y="70" fill="white" font-size="14">Player Angle: <tspan fill="#ffec99">45° (π/4 radians)</tspan></text>
                            <text x="30" y="90" fill="white" font-size="14">Screen Column: <tspan fill="#ffec99">x = 400 (center)</tspan></text>
                            <text x="30" y="110" fill="white" font-size="14">Screen Width: <tspan fill="#ffec99">800 pixels</tspan></text>
                        </g>

                        <!-- Visual Grid -->
                        <g transform="translate(500, 60)">
                            <rect x="0" y="0" width="400" height="120" rx="12" fill="rgba(0,0,0,0.5)" stroke="#333" stroke-width="2"/>
                            <text x="200" y="25" text-anchor="middle" fill="#88ddff" font-size="16" font-weight="bold">🗺️ VISUAL GRID</text>

                            <!-- Grid -->
                            <g transform="translate(50, 35)">
                                <!-- Grid lines -->
                                <line x1="0" y1="0" x2="300" y2="0" stroke="#333" stroke-width="1"/>
                                <line x1="0" y1="20" x2="300" y2="20" stroke="#333" stroke-width="1"/>
                                <line x1="0" y1="40" x2="300" y2="40" stroke="#333" stroke-width="1"/>
                                <line x1="0" y1="60" x2="300" y2="60" stroke="#333" stroke-width="1"/>

                                <line x1="0" y1="0" x2="0" y2="60" stroke="#333" stroke-width="1"/>
                                <line x1="60" y1="0" x2="60" y2="60" stroke="#333" stroke-width="1"/>
                                <line x1="120" y1="0" x2="120" y2="60" stroke="#333" stroke-width="1"/>
                                <line x1="180" y1="0" x2="180" y2="60" stroke="#333" stroke-width="1"/>
                                <line x1="240" y1="0" x2="240" y2="60" stroke="#333" stroke-width="1"/>
                                <line x1="300" y1="0" x2="300" y2="60" stroke="#333" stroke-width="1"/>

                                <!-- Wall -->
                                <rect x="180" y="0" width="60" height="60" fill="#666" stroke="#999"/>

                                <!-- Player -->
                                <circle cx="30" cy="30" r="4" fill="#ff6b6b"/>
                                <text x="30" y="45" text-anchor="middle" fill="#ff6b6b" font-size="8">Player</text>

                                <!-- Ray -->
                                <line x1="30" y1="30" x2="180" y2="15" stroke="#ffec99" stroke-width="2" stroke-dasharray="2,2"/>
                                <circle cx="180" cy="15" r="2" fill="#00ff88"/>
                                <text x="185" y="12" fill="#00ff88" font-size="8">Hit</text>
                            </g>
                        </g>

                        <!-- Step-by-step calculation -->
                        <g class="math-example" transform="translate(50, 200)">
                            <!-- Step 1 -->
                            <g transform="translate(0, 0)">
                                <rect x="0" y="0" width="900" height="80" rx="10" fill="url(#exampleGrad2)" filter="url(#exampleGlow)" stroke="#74c0fc" stroke-width="2"/>
                                <text x="450" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">🔢 STEP 1: Calculate Ray Angle</text>

                                <g transform="translate(30, 35)">
                                    <text x="0" y="15" fill="white" font-size="12" font-family="monospace">FOV = 60° = π/3</text>
                                    <text x="200" y="15" fill="white" font-size="12" font-family="monospace">step = π/3 / 800 = 0.00131</text>
                                    <text x="500" y="15" fill="white" font-size="12" font-family="monospace">ray_angle = π/4 - π/6 + 400×0.00131</text>
                                    <text x="0" y="35" fill="#ffec99" font-size="12" font-family="monospace">Result: ray_angle = 45°</text>
                                </g>
                            </g>

                            <!-- Step 2 -->
                            <g transform="translate(0, 100)">
                                <rect x="0" y="0" width="900" height="120" rx="10" fill="url(#exampleGrad2)" filter="url(#exampleGlow)" stroke="#74c0fc" stroke-width="2"/>
                                <text x="450" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">📏 STEP 2: Cast Ray (DDA Algorithm)</text>

                                <g transform="translate(30, 40)">
                                    <!-- Horizontal check -->
                                    <text x="0" y="15" fill="#ffd43b" font-size="14" font-weight="bold">Horizontal Check:</text>
                                    <text x="0" y="35" fill="white" font-size="12">• First intersection: y=256, x=256</text>
                                    <text x="0" y="50" fill="white" font-size="12">• Hit wall at: (384, 384)</text>
                                    <text x="0" y="65" fill="white" font-size="12">• Distance: √[(384-200)² + (384-200)²] = 260.2</text>

                                    <!-- Vertical check -->
                                    <text x="450" y="15" fill="#69db7c" font-size="14" font-weight="bold">Vertical Check:</text>
                                    <text x="450" y="35" fill="white" font-size="12">• First intersection: x=256, y=256</text>
                                    <text x="450" y="50" fill="white" font-size="12">• Hit wall at: (320, 320)</text>
                                    <text x="450" y="65" fill="white" font-size="12">• Distance: √[(320-200)² + (320-200)²] = 169.7</text>

                                    <text x="0" y="90" fill="#00ff88" font-size="14" font-weight="bold">✅ Closest: Vertical hit at (320, 320), distance = 169.7</text>
                                </g>
                            </g>

                            <!-- Step 3 -->
                            <g transform="translate(0, 240)">
                                <rect x="0" y="0" width="900" height="80" rx="10" fill="url(#exampleGrad3)" filter="url(#exampleGlow)" stroke="#ffd43b" stroke-width="2"/>
                                <text x="450" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">🐟 STEP 3: Fisheye Correction</text>

                                <g transform="translate(30, 40)">
                                    <text x="0" y="15" fill="white" font-size="12" font-family="monospace">corrected_dist = 169.7 × cos(45° - 45°)</text>
                                    <text x="400" y="15" fill="white" font-size="12" font-family="monospace">= 169.7 × cos(0°)</text>
                                    <text x="650" y="15" fill="white" font-size="12" font-family="monospace">= 169.7 × 1</text>
                                    <text x="0" y="35" fill="#00ff88" font-size="14" font-weight="bold">Result: corrected_distance = 169.7</text>
                                </g>
                            </g>

                            <!-- Step 4 -->
                            <g transform="translate(0, 340)">
                                <rect x="0" y="0" width="900" height="60" rx="10" fill="url(#exampleGrad1)" filter="url(#exampleGlow)" stroke="#00ff88" stroke-width="2"/>
                                <text x="450" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">🎨 STEP 4: Select Texture</text>

                                <g transform="translate(30, 35)">
                                    <text x="0" y="15" fill="white" font-size="12">Vertical hit, cos(45°) > 0 → <tspan fill="#74c0fc" font-weight="bold">Texture = EAST</tspan></text>
                                </g>
                            </g>

                            <!-- Step 5 -->
                            <g transform="translate(0, 420)">
                                <rect x="0" y="0" width="900" height="80" rx="10" fill="url(#exampleGrad2)" filter="url(#exampleGlow)" stroke="#74c0fc" stroke-width="2"/>
                                <text x="450" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">📐 STEP 5: Calculate Wall Height</text>

                                <g transform="translate(30, 40)">
                                    <text x="0" y="15" fill="white" font-size="12" font-family="monospace">wall_height = (64 × 800) / 169.7</text>
                                    <text x="400" y="15" fill="white" font-size="12" font-family="monospace">= 51200 / 169.7</text>
                                    <text x="0" y="35" fill="#00ff88" font-size="14" font-weight="bold">Result: wall_height = 301 pixels</text>
                                </g>
                            </g>

                            <!-- Step 6 -->
                            <g transform="translate(0, 520)">
                                <rect x="0" y="0" width="900" height="120" rx="10" fill="url(#exampleGrad1)" filter="url(#exampleGlow)" stroke="#00ff88" stroke-width="2"/>
                                <text x="450" y="25" text-anchor="middle" fill="white" font-size="16" font-weight="bold">🖼️ STEP 6: Draw Column</text>

                                <g transform="translate(30, 40)">
                                    <text x="0" y="15" fill="white" font-size="12" font-family="monospace">draw_start = 400 - 301/2 = 249</text>
                                    <text x="300" y="15" fill="white" font-size="12" font-family="monospace">draw_end = 400 + 301/2 = 551</text>

                                    <text x="0" y="40" fill="#74c0fc" font-size="12">Pixels 0-249: <tspan fill="#88ddff">Ceiling (blue)</tspan></text>
                                    <text x="0" y="60" fill="#69db7c" font-size="12">Pixels 249-551: <tspan fill="#00ff88">Textured wall</tspan></text>
                                    <text x="0" y="80" fill="#666" font-size="12">Pixels 551-800: <tspan fill="#888">Floor (gray)</tspan></text>

                                    <!-- Visual column -->
                                    <g transform="translate(600, 35)">
                                        <rect x="0" y="0" width="20" height="80" fill="#0a0a0a" stroke="#333"/>
                                        <rect x="0" y="0" width="20" height="20" fill="#88ddff"/>
                                        <rect x="0" y="20" width="20" height="40" fill="#00ff88"/>
                                        <rect x="0" y="60" width="20" height="20" fill="#666"/>
                                        <text x="30" y="40" fill="#ffffff" font-size="10">Screen Column 400</text>
                                    </g>
                                </g>
                            </g>
                        </g>

                        <!-- Final Result -->
                        <g transform="translate(200, 750)">
                            <rect x="0" y="0" width="600" height="80" rx="15" fill="linear-gradient(135deg, rgba(0,255,136,0.3), rgba(0,255,136,0.1))" stroke="#00ff88" stroke-width="3"/>
                            <text x="300" y="30" text-anchor="middle" fill="#00ff88" font-size="20" font-weight="bold">🎯 FINAL OUTPUT</text>
                            <text x="300" y="55" text-anchor="middle" fill="white" font-size="16">Column 400 drawn with 301-pixel tall wall!</text>
                            <text x="300" y="70" text-anchor="middle" fill="#ffec99" font-size="12">Complete ray trace from input to rendered pixel</text>
                        </g>

                        <!-- Performance note -->
                        <g transform="translate(50, 860)">
                            <rect x="0" y="0" width="900" height="50" rx="10" fill="rgba(255,221,68,0.2)" stroke="#ffd43b" stroke-width="2"/>
                            <text x="450" y="25" text-anchor="middle" fill="#ffd43b" font-size="16" font-weight="bold">⚡ This process repeats 800 times per frame (once per screen column)</text>
                            <text x="450" y="40" text-anchor="middle" fill="white" font-size="12">Total time: ~15ms for complete frame rendering at 60 FPS</text>
                        </g>
                    </svg>
                </div>
            </div>
        </section>

        <footer style="background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(30, 60, 114, 0.4)); text-align: center; margin-top: 50px; padding: 40px 20px; border-top: 3px solid #00ff88; border-radius: 15px 15px 0 0; box-shadow: 0 -10px 30px rgba(0,0,0,0.5);">
            <h3 style="color: #00ff88; font-size: 1.5em; margin-bottom: 20px; text-shadow: 0 0 10px rgba(0,255,136,0.5);">🎯 END OF VISUAL DOCUMENTATION</h3>
            <p style="color: #88ddff; font-size: 1.1em; margin-bottom: 15px;"><em>For detailed code explanations, see RAYCASTING_DOCUMENTATION.md</em></p>
            <div style="margin: 30px 0; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px; display: inline-block;">
                <p style="color: #ffdd44; font-size: 1em; margin: 0;">
                    ⭐ <strong>Interactive Features:</strong> SVG animations, hover effects, smooth scrolling, progress tracking
                </p>
            </div>
            <p style="margin-top: 25px; color: #ccc; font-size: 0.9em;">
                Created for <span style="color: #00ff88; font-weight: bold;">CUB3D Raycasting Engine</span> |
                <span style="color: #88ddff;">Interactive HTML Guide with Professional Graphics</span>
            </p>
            <div style="margin-top: 20px; display: flex; justify-content: center; gap: 30px; flex-wrap: wrap;">
                <div style="color: #ff6b6b;">🎨 Visual Design</div>
                <div style="color: #74c0fc;">📐 Mathematical Accuracy</div>
                <div style="color: #69db7c;">⚡ Performance Optimized</div>
                <div style="color: #ffd43b;">🎯 Educational Focus</div>
            </div>
        </footer>
    </div>

    <script>
        // Create floating particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const numberOfParticles = 50;

            for (let i = 0; i < numberOfParticles; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';

                // Random colors
                const colors = ['#00ff88', '#88ddff', '#ffdd44', '#ff6b6b'];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];

                particlesContainer.appendChild(particle);
            }
        }

        // Progress bar
        function updateProgressBar() {
            const scrollTop = window.pageYOffset;
            const docHeight = document.documentElement.scrollHeight - window.innerHeight;
            const scrollPercent = (scrollTop / docHeight) * 100;

            document.getElementById('progressBar').style.width = scrollPercent + '%';
        }

        // Scroll indicator
        function getSectionsList() {
            const advancedHidden = document.body.classList.contains('hide-advanced');
            return advancedHidden
                ? ['simple']
                : ['simple', 'overview', 'dda', 'texture', 'problems', 'reference', 'mathematical', 'input-output', 'example'];
        }

        function updateScrollIndicator() {
            const sections = getSectionsList();
            const dots = document.querySelectorAll('.scroll-dot');
            const scrollPosition = window.pageYOffset + window.innerHeight / 2;

            // Toggle dot visibility for visible sections only
            dots.forEach(dot => {
                const target = dot.getAttribute('data-target');
                dot.style.display = sections.includes(target) ? '' : 'none';
            });

            sections.forEach((sectionId, index) => {
                const section = document.getElementById(sectionId);
                if (section) {
                    const sectionTop = section.offsetTop;
                    const sectionBottom = sectionTop + section.offsetHeight;

                    if (scrollPosition >= sectionTop && scrollPosition <= sectionBottom) {
                        dots.forEach(dot => dot.classList.remove('active'));
                        if (dots[index]) dots[index].classList.add('active');
                    }
                }
            });
        }

        // Smooth scrolling for navigation links
        document.querySelectorAll('.nav-menu a, .scroll-dot').forEach(element => {
            element.addEventListener('click', function (e) {
                e.preventDefault();

                let targetId;
                if (this.classList.contains('scroll-dot')) {
                    targetId = this.getAttribute('data-target');
                } else {
                    targetId = this.getAttribute('href').substring(1);
                }

                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Enhanced click effects for code blocks
        document.querySelectorAll('.code-block, .ascii-art').forEach(block => {
            block.addEventListener('click', function() {
                // Create ripple effect
                const ripple = document.createElement('div');
                ripple.style.position = 'absolute';
                ripple.style.borderRadius = '50%';
                ripple.style.background = 'rgba(0, 255, 136, 0.3)';
                ripple.style.transform = 'scale(0)';
                ripple.style.animation = 'ripple 0.6s linear';
                ripple.style.left = '50%';
                ripple.style.top = '50%';
                ripple.style.width = '20px';
                ripple.style.height = '20px';
                ripple.style.marginLeft = '-10px';
                ripple.style.marginTop = '-10px';

                this.style.position = 'relative';
                this.appendChild(ripple);

                // Enhanced glow effect
                this.style.boxShadow = '0 0 30px rgba(0, 255, 136, 0.6)';
                this.style.transform = 'scale(1.02)';

                setTimeout(() => {
                    this.style.boxShadow = '';
                    this.style.transform = '';
                    if (ripple.parentNode) {
                        ripple.parentNode.removeChild(ripple);
                    }
                }, 1000);
            });
        });

        // Add ripple animation to CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes ripple {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // Intersection Observer for animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        // Initialize animations
        document.querySelectorAll('.flowchart').forEach(chart => {
            chart.style.opacity = '0';
            chart.style.transform = 'translateY(30px)';
            chart.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            observer.observe(chart);
        });

        // Mobile responsive adjustments
        function handleMobileView() {
            if (window.innerWidth <= 768) {
                const navMenu = document.querySelector('.nav-menu');
                navMenu.style.flexDirection = 'column';

                // Hide scroll indicator on mobile
                const scrollIndicator = document.getElementById('scrollIndicator');
                scrollIndicator.style.display = 'none';
            }
        }

        // Event listeners
        window.addEventListener('scroll', () => {
            updateProgressBar();
            updateScrollIndicator();
        });

        window.addEventListener('resize', handleMobileView);

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            createParticles();
            handleMobileView();
            updateProgressBar();
            updateScrollIndicator();

            // Clarity toolbar wiring
            const simpleBtn = document.getElementById('toggleSimple');
            const summariesBtn = document.getElementById('toggleSummaries');
            const advancedBtn = document.getElementById('toggleAdvanced');
            let summariesVisible = true;

            // Default: simple visuals; advanced content visible
            document.body.classList.add('simple');

            if (simpleBtn) {
                simpleBtn.addEventListener('click', () => {
                    document.body.classList.toggle('simple');
                    const isSimple = document.body.classList.contains('simple');
                    simpleBtn.textContent = isSimple ? '✨ Rich mode' : '🧼 Simple mode';
                });
            }

            if (summariesBtn) {
                summariesBtn.addEventListener('click', () => {
                    summariesVisible = !summariesVisible;
                    document.querySelectorAll('.summary').forEach(el => {
                        el.style.display = summariesVisible ? '' : 'none';
                    });
                    summariesBtn.textContent = summariesVisible ? '🙈 Hide TL;DR' : '📝 Show TL;DR';
                });
                // Start with TL;DR visible and proper label
                summariesBtn.textContent = '🙈 Hide TL;DR';
            }

            if (advancedBtn) {
                advancedBtn.addEventListener('click', () => {
                    document.body.classList.toggle('hide-advanced');
                    const hidden = document.body.classList.contains('hide-advanced');
                    advancedBtn.textContent = hidden ? '🔎 Show advanced' : '👁️ Hide advanced';
                    // Toggle advanced nav links and update dots
                    document.querySelectorAll('.nav-menu a[data-advanced="true"]').forEach(a => {
                        if (hidden) a.classList.add('disabled'); else a.classList.remove('disabled');
                    });
                    updateScrollIndicator();
                });
                // Initial label (advanced is visible)
                advancedBtn.textContent = '👁️ Hide advanced';
            }
        });

        // Add keyboard navigation
        document.addEventListener('keydown', (e) => {
            const sections = getSectionsList();
            const currentIndex = sections.findIndex(section => {
                const element = document.getElementById(section);
                const rect = element.getBoundingClientRect();
                return rect.top <= window.innerHeight / 2 && rect.bottom >= window.innerHeight / 2;
            });

            if (e.key === 'ArrowDown' && currentIndex < sections.length - 1) {
                e.preventDefault();
                document.getElementById(sections[currentIndex + 1]).scrollIntoView({
                    behavior: 'smooth'
                });
            } else if (e.key === 'ArrowUp' && currentIndex > 0) {
                e.preventDefault();
                document.getElementById(sections[currentIndex - 1]).scrollIntoView({
                    behavior: 'smooth'
                });
            }
        });
    </script>
</body>
</html>
